<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Proactive Assistant</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        /* --- Global Styles & Variables --- */
        :root {
            --grab-green: #00B14F;
            --grab-green-light: #E6F7EE;
            --grab-green-dark: #008a40;
            --apple-blue-action: #0A84FF;
            --user-bubble-bg: var(--grab-green);
            --ai-bubble-bg: #FFFFFF;
            --border-color: #EAEAEA; /* Slightly lighter */
            --soft-black: #1d1d1f;
            --secondary-text: #6e6e73;
            --tertiary-text: #8e8e93;
            --light-gray-bg: #f5f5f7; /* Apple's light background */
            --white: #FFFFFF;
            --red-action: #FF453A; /* Apple Red */
            --system-font: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
            --bubble-border-radius: 20px;
            --container-padding: 18px;
            --gradient-start: #fdfdfd;
            --gradient-end: #f7f7f7; /* Subtle gradient */
            --button-shadow: 0 4px 10px rgba(0, 177, 79, 0.15);
            --bubble-shadow: 0 1.5px 3px rgba(0, 0, 0, 0.07); /* Softer bubble shadow */
            --modal-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; }
        html, body { height: 100%; overflow: hidden; } /* Prevent body scroll */

        body {
            font-family: var(--system-font);
            background-color: #cccccc; /* Background outside the phone */
            display: flex; justify-content: center; align-items: center; padding: 30px 0; /* Increased padding for more vertical space */
            overflow: hidden; /* Ensure no scrollbars */
        }

        /* --- Phone Mockup Frame (Strict Size) --- */
        .phone-mockup {
            width: 390px; /* iPhone 13 Pro width */
            height: 844px; /* iPhone 13 Pro height */
            border: 12px solid #111; /* Phone bezel */
            border-radius: 50px; /* Rounded corners */
            background: linear-gradient(180deg, var(--gradient-start) 0%, var(--gradient-end) 100%); /* Subtle background */
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3); /* Phone shadow */
            display: flex; flex-direction: column; /* Stack elements vertically */
            overflow: hidden; /* Clip content to frame */
            position: relative; /* For notch */
            margin: 0 40px; /* Added horizontal margin */
        }
        .phone-mockup::before { /* Notch */
            content: ''; position: absolute; /* Match border */ left: 50%; transform: translateX(-50%);
            width: 150px; height: 30px; background-color: #111; border-radius: 0 0 15px 15px; z-index: 100;
        }

        /* --- Chat App Container --- */
        .chat-app { flex-grow: 1; display: flex; flex-direction: column; height: 100%; background-color: var(--white); }

        /* --- Header --- */
        .chat-header {
            padding: 10px var(--container-padding); padding-top: 50px; /* Space for notch */
            background: rgba(252, 252, 252, 0.9); /* Semi-transparent white */
            backdrop-filter: blur(18px); -webkit-backdrop-filter: blur(18px); /* iOS blur effect */
            border-bottom: 1px solid var(--border-color);
            position: sticky; top: 0; z-index: 50; /* Stick to top */
            display: flex; align-items: center; justify-content: space-between;
            position: relative;
        }
        .avatar { width: 36px; height: 36px; border-radius: 50%; background-color: var(--tertiary-text); border: 1px solid var(--border-color); overflow: hidden; flex-shrink: 0; }
        /* Simple initial placeholder */
        .avatar::before { content: 'GA'; display: flex; align-items: center; justify-content: center; width: 100%; height: 100%; color: white; font-weight: 500; font-size: 14px; background-color: var(--grab-green); }
        .header-title { 
            font-size: 17px; 
            font-weight: 600; 
            color: var(--soft-black); 
            text-align: center; 
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 200px;
            pointer-events: none;
        }
        .reset-button {
            margin-left: auto;
            z-index: 1;
        }

        /* Language Selector */
        .language-selector {
            position: relative;
            margin-left: auto;
            cursor: pointer;
            z-index: 100;
        }
        
        .language-icon {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background-color: var(--light-gray-bg);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--grab-green);
            font-size: 16px;
            transition: background-color 0.2s ease;
        }
        
        .language-icon:hover {
            background-color: var(--grab-green-light);
        }

        /* Reset Button Styles */
        .reset-button {
            width: 32px;
            padding-left: 8px;
            padding-top: 5px;
            height: 32px;
            border-radius: 50%;
            background-color: var(--light-gray-bg);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--grab-green);
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.2s ease;
        
        }

        .reset-button:hover {
            background-color: var(--grab-green-light);
        }
        
        .language-dropdown {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 280px;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            overflow: hidden;
            z-index: 1000;
            display: none;
        }
        
        .language-dropdown.active {
            display: block;
        }
        
        .language-option {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            transition: background-color 0.2s ease;
            cursor: pointer;
        }
        
        .language-option:hover {
            background-color: var(--light-gray-bg);
        }

        .blinking-cursor {
            margin-left: 5px;
            background-color: #fff;
            animation: blink 1s infinite;
        }
        @keyframes blink {
            0%, 50% {
            opacity: 1;
            }
            50.1%, 100% {
            opacity: 0;
            }
        }
        
        .language-flag {
            width: 32px;
            height: 24px;
            border-radius: 4px;
            margin-right: 12px;
            object-fit: cover;
        }
        
        .language-name {
            font-size: 15px;
            color: var(--soft-black);
        }
        
        .language-selected {
            background-color: var(--grab-green-light);
            color: var(--grab-green-dark);
            font-weight: 500;
        }
        
        .language-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 999;
            display: none;
        }
        
        .language-overlay.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* --- Messages Area --- */
        .chat-messages {
            flex-grow: 1; 
            overflow-y: auto; 
            padding: var(--container-padding); 
            display: flex; 
            flex-direction: column; 
            gap: 12px;
            scrollbar-width: none; /* Firefox */
            -ms-overflow-style: none; /* IE and Edge */
        }
        
        .chat-messages::-webkit-scrollbar {
            display: none; /* Chrome, Safari, Opera */
        }

        /* --- Message Bubbles --- */
        .message { display: flex; max-width: 88%; margin-bottom: 14px; opacity: 0; transform: translateY(12px); animation: fadeIn 0.55s cubic-bezier(0.25, 1, 0.5, 1) forwards; }
        @keyframes fadeIn { to { opacity: 1; transform: translateY(0); } }
        .message.ai { align-self: flex-start; }
        .message.user { align-self: flex-end; }

        .bubble { padding: 12px 16px; border-radius: var(--bubble-border-radius); font-size: 17px; line-height: 1.48; box-shadow: var(--bubble-shadow); word-wrap: break-word; position: relative; }
        .message.ai .bubble { background-color: var(--ai-bubble-bg); color: var(--soft-black); border: 1px solid var(--border-color); border-top-left-radius: 6px; /* Flat corner like iMessage */ }
        .message.user .bubble { background-color: var(--user-bubble-bg); color: var(--white); border-top-right-radius: 6px; /* Flat corner */ box-shadow: 0 2px 4px rgba(0, 177, 79, 0.2); /* Greenish shadow */ }
        .bubble p { margin: 0; }
        .bubble p + p, .bubble ul + p, .bubble .graph-container + p, .bubble .button-container + p { margin-top: 10px; } /* Consistent spacing */
        .bubble strong { font-weight: 600; }
        .bubble ul { margin: 10px 0 8px 20px; padding: 0; }
        .bubble li { margin-bottom: 5px; color: inherit; }
        .message.ai .bubble li { color: var(--soft-black); }
        .message.user .bubble li { color: var(--white); }
        .bubble .success-text { color: var(--grab-green-dark); font-weight: 500; }
        .bubble .warning-text { color: #FF9F0A; font-weight: 500; } /* Apple Orange for warning */
        .bubble .greyed-out-info { color: var(--secondary-text); font-style: italic; font-size: 0.9em; margin-top: 6px; display: block; }
        .bubble .timestamp { font-size: 11px; color: var(--tertiary-text); text-align: right; margin-top: 8px; display: block; opacity: 0.7; }
        .message.user .bubble .timestamp { color: white; }

        /* --- Input Area --- */
        .input-area {
            padding: 12px var(--container-padding);
            background: rgba(252, 252, 252, 0.9);
            backdrop-filter: blur(18px);
            -webkit-backdrop-filter: blur(18px);
            border-top: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .input-field {
            flex-grow: 1;
            border: 1px solid var(--border-color);
            border-radius: 20px;
            padding: 10px 15px;
            font-size: 16px;
            outline: none;
            background-color: var(--white);
            transition: border-color 0.2s ease;
        }
        .input-field:focus {
            border-color: var(--grab-green);
        }
        
        /* Reset Chat Button Styles */
        .reset-chat-button {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background-color: var(--light-gray-bg);
            color: var(--grab-green);
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background-color 0.2s ease;
            margin-right: 5px;
            position: relative;
        }
        
        .reset-chat-button i {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 16px;
            line-height: 1;
        }
        
        .reset-chat-button:hover {
            background-color: var(--grab-green-light);
        }
        
        .mic-button, .send-button {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background-color: var(--grab-green);
            color: var(--white);
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        .mic-button:hover, .send-button:hover {
            background-color: var(--grab-green-dark);
        }
        .mic-button.recording {
            background-color: var(--red-action);
            animation: pulse 1.5s infinite;
        }
        .mic-button.recording::after {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background-color: var(--red-action);
            opacity: 0.4;
            animation: ripple 1.5s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        @keyframes ripple {
            0% { transform: scale(1); opacity: 0.4; }
            100% { transform: scale(1.5); opacity: 0; }
        }

        /* --- Chat List --- */
        .chat-list {
            flex-grow: 1;
            overflow-y: auto;
            padding: var(--container-padding);
            background-color: var(--light-gray-bg);
        }

        .chat-item {
            background: var(--white);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            position: relative;
        }

        .chat-item.pro-version {
            border: 2px solid var(--grab-green);
        }

        .pro-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: var(--grab-green);
            color: white;
            font-size: 11px;
            font-weight: 600;
            padding: 4px 8px;
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0, 177, 79, 0.2);
            display: flex;
            align-items: center;
            gap: 4px;
            z-index: 1;
        }

        .pro-badge i {
            font-size: 10px;
        }

        .chat-item.pro-version:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 177, 79, 0.15);
        }

        .chat-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .chat-item-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .chat-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--grab-green-light);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--grab-green);
            font-size: 18px;
        }

        .chat-title {
            font-weight: 600;
            color: var(--soft-black);
            font-size: 16px;
        }

        .chat-preview {
            color: var(--secondary-text);
            font-size: 14px;
            line-height: 1.4;
        }

        .chat-time {
            font-size: 12px;
            color: var(--secondary-text);
            margin-top: 8px;
        }

        .alert-badge {
            background: var(--red-action);
            color: white;
            font-size: 12px;
            padding: 2px 8px;
            border-radius: 10px;
            margin-left: auto;
        }

        /* --- Charts and Metrics --- */
        .chart-container {
            width: 100%;
            max-width: 100%;
            background: white;
            border-radius: 12px;
            padding: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            margin: 8px 0;
            display: grid;
            grid-template-rows: auto 1fr;
            gap: 12px;
            box-sizing: border-box;
        }

        .chart-tabs {
            display: flex;
            gap: 4px;
            overflow-x: auto;
            padding-bottom: 4px;
            scrollbar-width: none;
            -ms-overflow-style: none;
            width: 100%;
            box-sizing: border-box;
        }

        .chart-tabs::-webkit-scrollbar {
            display: none;
        }

        .chart-tab {
            flex: 1;
            min-width: 80px;
            padding: 6px 8px;
            background: var(--grab-green-light);
            border-radius: 6px;
            color: var(--grab-green);
            font-size: 11px;
            font-weight: 500;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
            white-space: nowrap;
            box-sizing: border-box;
        }

        .chart-tab i {
            font-size: 12px;
        }

        .chart-tab.active {
            background: var(--grab-green);
            color: white;
        }

        .chart-content-container {
            position: relative;
            width: 100%;
            height: 160px;
            overflow: hidden;
            box-sizing: border-box;
        }

        .chart-content {
            position: absolute;
            width: 100%;
            height: 100%;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            box-sizing: border-box;
        }

        .chart-content.active {
            opacity: 1;
            visibility: visible;
        }

        .line-chart {
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        .line-chart .line {
            stroke: var(--grab-green);
            stroke-width: 2;
            fill: none;
            stroke-dasharray: 1000;
            stroke-dashoffset: 1000;
        }

        .line-chart .area {
            fill: url(#gradient);
            opacity: 0;
        }

        .pie-chart {
            width: 130px;
            height: 130px;
            margin: 0 auto;
            overflow: visible;
        }

        .pie-segment {
            transform-origin: center;
            transform: rotate(-90deg);
            stroke-dashoffset: 502.4;
        }

        @keyframes drawLine {
            to { stroke-dashoffset: 0; }
        }

        @keyframes drawPie {
            to { stroke-dashoffset: 0; }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        function switchChart(tab, chartId) {
            // Remove active class from all tabs and contents
            document.querySelectorAll('.chart-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.chart-content').forEach(c => c.classList.remove('active'));
            
            // Add active class to clicked tab and corresponding content
            tab.classList.add('active');
            document.getElementById(chartId + '-chart').classList.add('active');
        }



        .chart-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--soft-black);
            margin-bottom: 12px;
        }

        .chart {
            width: 100%;
            height: 150px;
            position: relative;
            display: flex;
            align-items: flex-end;
            gap: 8px;
            padding: 8px 0;
        }

        .bar {
            flex: 1;
            background: var(--grab-green-light);
            border-radius: 4px 4px 0 0;
            position: relative;
            transition: height 0.3s ease;
        }

        .bar::after {
            content: attr(data-value);
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 12px;
            color: var(--secondary-text);
        }

        .bar-label {
            position: absolute;
            bottom: -24px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 12px;
            color: var(--secondary-text);
            white-space: nowrap;
        }

        .metric-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin: 8px 0;
        }

        .metric-card {
            background: var(--white);
            border-radius: 12px;
            padding: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .metric-title {
            font-size: 12px;
            color: var(--secondary-text);
            margin-bottom: 4px;
        }

        .metric-value {
            font-size: 18px;
            font-weight: 600;
            color: var(--soft-black);
        }

        .metric-trend {
            font-size: 12px;
            color: var(--grab-green);
            margin-top: 4px;
        }

        .metric-trend.negative {
            color: var(--red-action);
        }

        .time-indicator {
            font-size: 12px;
            color: var(--secondary-text);
            text-align: center;
            margin: 8px 0;
        }

        /* --- Graph Animation Styles --- */
        .graph-container {
            margin-top: 15px;
            height: 200px;
            position: relative;
            overflow: hidden;
        }
        
        .graph-bar {
            position: absolute;
            bottom: 0;
            width: 30px;
            background: var(--grab-green);
            border-radius: 4px 4px 0 0;
            opacity: 0.8;
            transform-origin: bottom;
            animation: growBar 1s ease-out forwards;
        }
        
        .graph-label {
            position: absolute;
            bottom: -25px;
            width: 30px;
            text-align: center;
            font-size: 12px;
            color: var(--secondary-text);
        }
        
        .graph-value {
            position: absolute;
            top: -20px;
            width: 30px;
            text-align: center;
            font-size: 12px;
            color: var(--grab-green);
            font-weight: 500;
        }
        
        @keyframes growBar {
            from {
                transform: scaleY(0);
            }
            to {
                transform: scaleY(1);
            }
        }

        /* --- Tabbed Charts Styles --- */
        .charts-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
        }
        
        .chart-tab {
            padding: 8px 12px;
            background: var(--light-gray-bg);
            border-radius: 20px;
            font-size: 13px;
            color: var(--secondary-text);
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .chart-tab.active {
            background: var(--grab-green);
            color: white;
        }
        
        .chart-content {
            display: none;
            height: 250px;
            position: relative;
        }
        
        .chart-content.active {
            display: block;
        }
        
        .line-chart {
            height: 200px;
            position: relative;
            padding: 20px 0;
        }
        
        .chart-line {
            fill: none;
            stroke: var(--grab-green);
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
            stroke-dasharray: 1000;
            stroke-dashoffset: 1000;
            animation: drawLine 2s ease-out forwards;
        }
        
        .chart-area {
            fill: var(--grab-green-light);
            opacity: 0;
            animation: fadeIn 1s ease-out 0.5s forwards;
        }
        
        .chart-point {
            fill: var(--grab-green);
            opacity: 0;
            animation: fadeIn 0.3s ease-out forwards;
        }
        
        .chart-label {
            position: absolute;
            font-size: 8px;
            color: var(--secondary-text);
            transform: translateX(-50%);
            bottom: 0;
        }
        
        .chart-value {
            position: absolute;
            font-size: 11px;
            color: var(--grab-green);
            transform: translate(-50%, -20px);
        }
        
        .pie-chart {
            width: 180px;
            height: 180px;
            margin: 0 auto;
            position: relative;
        }
        
        .pie-segment {
            transform-origin: center;
            transition: transform 0.2s;
            animation: growSegment 1s ease-out forwards;
        }
        
        .pie-label {
            position: absolute;
            font-size: 12px;
            color: var(--secondary-text);
            transform: translateY(-50%);
            display: flex;
            align-items: center;
            gap: 6px;
            opacity: 0;
            animation: fadeIn 0.5s ease-out forwards;
        }
        
        .pie-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }
        
        @keyframes growSegment {
            from {
                transform: scale(0);
            }
            to {
                transform: scale(1);
            }
        }
        
        /* --- Insights Styles --- */
        .insights-container {
            background: white;
            border-radius: 12px;
            padding: 15px;
            margin: 10px 0;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .insight-item {
            padding: 12px;
            border-bottom: 1px solid var(--grab-green-light);
            margin-bottom: 8px;
        }

        .insight-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }
        
        .insight-title {
            color: var(--grab-green);
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 6px;
        }
        
        .insight-text {
            color: var(--secondary-text);
            font-size: 13px;
            line-height: 1.4;
        }
        
        .insight-highlight {
            color: var(--grab-green);
            font-weight: 500;
        }

        /* --- Back Button --- */
        .back-button {
            color: var(--grab-green);
            font-size: 20px;
            cursor: pointer;
            display: none;
        }

        /* --- Typing Indicator --- */
        .message.typing-indicator .bubble { background-color: var(--light-gray-bg); border: none; box-shadow: var(--bubble-shadow); padding: 13px 15px; display: inline-flex; align-items: center; border-top-left-radius: 6px; /* Match AI bubble */ }
        .typing-dot { width: 9px; height: 9px; border-radius: 50%; background-color: var(--tertiary-text); margin: 0 3.5px; animation: typing 1.5s infinite both ease-in-out; }
        .typing-dot:nth-child(1) { animation-delay: 0.0s; } .typing-dot:nth-child(2) { animation-delay: 0.2s; } .typing-dot:nth-child(3) { animation-delay: 0.4s; }
        @keyframes typing { 0%, 60%, 100% { transform: scale(0.5); opacity: 0.6; } 30% { transform: scale(1.0); opacity: 1; } }

        /* Performance Metrics Styles */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-top: 16px;
        }
        
        .metric-card {
            background: white;
            border-radius: 12px;
            padding: 16px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .metric-title {
            font-size: 14px;
            color: var(--secondary-text);
            margin-bottom: 8px;
        }
        
        .metric-value {
            font-size: 20px;
            font-weight: 600;
            color: var(--text-color);
            margin-bottom: 4px;
        }
        
        .metric-change {
            font-size: 14px;
            color: var(--grab-green);
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .metric-change i {
            font-size: 12px;
        }
        
        /* Chart Styles */
        .charts-container {
            margin-top: 15px;
        }
        
        .revenue-chart {
            height: 200px;
            margin-top: 20px;
            position: relative;
            display: flex;
            align-items: flex-end;
            gap: 8px;
            padding-bottom: 25px;
        }
        
        .revenue-bar {
            flex: 1;
            background: var(--grab-green);
            opacity: 0.8;
            border-radius: 4px 4px 0 0;
            position: relative;
            transform-origin: bottom;
            animation: growBar 1.5s ease-out forwards;
        }
        
        .revenue-label {
            position: absolute;
            bottom: -35px;
            left: 0;
            right: 0;
            text-align: center;
            font-size: 11px;
            color: var(--secondary-text);
        }
        
        .satisfaction-chart {
            height: 150px;
            margin-top: 30px;
            position: relative;
            padding-bottom: 25px;
        }
        
        .satisfaction-line {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 100%;
            fill: none;
            stroke: var(--grab-green);
            stroke-width: 2;
            stroke-linecap: round;
            stroke-dasharray: 1000;
            stroke-dashoffset: 1000;
            animation: drawLine 2s ease-out forwards;
        }
        
        .satisfaction-point {
            position: absolute;
            width: 8px;
            height: 8px;
            background: var(--grab-green);
            border-radius: 50%;
            transform: scale(0);
            animation: popPoint 0.3s ease-out forwards;
        }
        
        @keyframes drawLine {
            to {
                stroke-dashoffset: 0;
            }
        }
        
        @keyframes popPoint {
            to {
                transform: scale(1);
            }
        }
        
        @keyframes growBar {
            from {
                transform: scaleY(0);
            }
            to {
                transform: scaleY(1);
            }
        }
        
        /* Chart Styles */
        .chart-container {
            background: white;
            border-radius: 12px;
            padding: 16px;
            margin-top: 16px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);

        }

        .chart-tabs {
            display: flex;
            gap: 12px;
            margin-bottom: 16px;
            overflow-x: auto;
            padding-bottom: 4px;
        }

        .chart-tab {
            padding: 8px 16px;
            border-radius: 20px;
            background: var(--grab-green-light);
            color: var(--grab-green);
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }

        .chart-tab.active {
            background: var(--grab-green);
            color: white;
        }

        .chart-content-container {
            position: relative;
            height: 200px;
        }

        .chart-content {
            position: absolute;
            width: 100%;
            height: 100%;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease;
        }

        .chart-content.active {
            opacity: 1;
            visibility: visible;
        }

        /* Line Chart Styles */
        .line-chart {
            width: 100%;
            height: 100%;
        }

        .line-chart .line {
            stroke-dasharray: 1000;
            stroke-dashoffset: 1000;
            animation: drawLine 2s ease-out forwards;
        }

        .line-chart .area {
            opacity: 0;
            animation: fadeIn 1s ease-out 0.5s forwards;
        }

        /* Pie Chart Styles */
        .pie-chart {
            width: 100%;
            height: 100%;
        }

        .pie-chart .pie-segment {
            transform-origin: center;
            transform: rotate(-90deg);
            stroke-dashoffset: 0;
            animation: drawPie 1s ease-out forwards;
        }

        /* Insights Styles */
        .insights-container {
            display: flex;
            flex-direction: column;
            gap: 16px;
            margin-top: 16px;
        }

        .insight-item {
            display: flex;
            gap: 12px;
            padding: 16px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .insight-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--grab-green-light);
            color: var(--grab-green);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            flex-shrink: 0;
        }

        .insight-content {
            flex: 1;
        }

        .insight-content h4 {
            margin: 0 0 8px 0;
            color: var(--text-color);
            font-size: 16px;
        }

        .insight-content p {
            margin: 0;
            color: var(--secondary-text);
            font-size: 14px;
            line-height: 1.4;
        }

        /* Animations */
        @keyframes slideUp {
            from {
                transform: translateY(20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes drawLine {
            to { stroke-dashoffset: 0; }
        }

        @keyframes drawPie {
            from { stroke-dashoffset: 502.4; }
            to { stroke-dashoffset: 0; }
        }
        
        /* Recording Animation Styles */
        .recording-interface {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            margin: 10px 0;
            background: var(--white);
            border-radius: var(--bubble-border-radius);
            box-shadow: var(--bubble-shadow);
            animation: fadeIn 0.3s ease-out;
        }
        
        .recording-animation {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            margin-bottom: 10px;
            height: 40px;
        }
        
        .recording-wave {
            width: 4px;
            height: 20px;
            background-color: var(--grab-green);
            border-radius: 2px;
            animation: waveAnimation 1s infinite ease-in-out;
        }
        
        .recording-wave:nth-child(2) {
            animation-delay: 0.2s;
            height: 35px;
        }
        
        .recording-wave:nth-child(3) {
            animation-delay: 0.4s;
            height: 25px;
        }
        
        .recording-wave:nth-child(4) {
            animation-delay: 0.6s;
            height: 30px;
        }
        
        .recording-wave:nth-child(5) {
            animation-delay: 0.8s;
            height: 22px;
        }
        
        .recording-text {
            font-size: 14px;
            color: var(--grab-green);
            font-weight: 500;
        }
        
        @keyframes waveAnimation {
            0%, 100% {
                transform: scaleY(0.5);
            }
            50% {
                transform: scaleY(1);
            }
        }
        
        /* Inventory Status Styles */
        .inventory-status {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px;
            background-color: white;
            border-radius: 12px;
            margin-top: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .inventory-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--grab-green-light);
            color: var(--grab-green);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }
        
        .inventory-details {
            flex: 1;
        }
        
        .inventory-name {
            font-weight: 600;
            margin-bottom: 4px;
        }
        
        .inventory-level {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 4px;
        }
        
        .inventory-level.critical {
            color: #e74c3c;
        }
        
        .inventory-status-text {
            font-size: 12px;
            color: #e74c3c;
            font-weight: 500;
        }
        
        /* Proactive Notification Styles */
        .proactive-notification {
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            overflow: hidden;
            margin: 10px 0;
            border-left: 4px solid var(--grab-green);
            animation: slideIn 0.5s ease-out;
        }
        
        @keyframes slideIn {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }
        
        .notification-header {
            background-color: var(--grab-green-light);
            padding: 12px 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .notification-header i {
            color: var(--grab-green);
            font-size: 16px;
        }
        
        .notification-header span {
            font-weight: 600;
            color: var(--grab-green-dark);
        }
        
        .notification-content {
            padding: 12px 15px;
        }
        
        .notification-content p {
            margin: 0;
            color: var(--soft-black);
        }
        
        .notification-actions {
            display: grid;
            grid-template-columns: 1fr;
            gap: 8px;
            padding: 0 15px 15px;
        }
        
        /* Weekly Report Styles */
        .weekly-report-container {
            margin: -5px;

            
            background-color: white;
            border-radius: 12px;
            font-size: 14px;
            max-width: 300px;
            overflow-x: auto;
        }
        
        .report-header {
            margin-bottom: 20px;
            border-bottom: 1px solid #eee;
            padding-bottom: 15px;
        }
        
        .report-header h3 {
            margin: 0 0 5px 0;
            color: var(--grab-green-dark);
        }
        
        .report-header p {
            margin: 0;
            color: var(--secondary-text);
        }
        
        .report-section {
            margin-bottom: 10px;
        }
        
        .report-section h4 {
            margin: 0 0 10px 0;
            color: var(--grab-green-dark);
            font-size: 16px;
        }
        
        .performance-table, .items-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            font-size: 12px;
        }
        
        .performance-table th, .items-table th {
            background-color: var(--grab-green-light);
            color: var(--grab-green-dark);
            text-align: left;
            padding: 8px;
            font-weight: 600;
            width: 25%;
        }
        
        .performance-table td, .items-table td {
            padding: 8px;
            border-bottom: 1px solid #eee;
        }
        
        .performance-table tr:nth-child(even), .items-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        
        .report-summary {
            margin: 20px 0;
            background-color: var(--grab-green-light);
            padding: 15px;
            border-radius: 8px;
        }
        
        .summary-value {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .summary-value strong {
            font-size: 24px;
            color: var(--grab-green-dark);
        }
        
        .report-actions {
            margin-top: 20px;
            display: flex;
            justify-content: center;
        }
        
        .pdf-button {
            padding: 10px 20px;
            background-color: var(--grab-green);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .pdf-button:hover {
            background-color: var(--grab-green-dark);
        }
        
        .pdf-loading {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-size: 16px;
            z-index: 1000;
        }
        
        .pdf-success {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-size: 16px;
            color: var(--grab-green);
            z-index: 1000;
        }
        
        /* Tab Styles */
        .report-tabs {
            margin: 20px 0;
        }
        
        .tab-header {
            display: flex;
            border-bottom: 1px solid #eee;
            margin-bottom: 15px;
        }
        
        .tab-button {
            padding: 10px 15px;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-weight: 500;
            color: var(--secondary-text);
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .tab-button.active {
            color: var(--grab-green);
            border-bottom: 3px solid var(--grab-green);
        }
        
        .tab-content {
            display: none;
            padding: 15px 0;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Chart Styles */
        .chart-container {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            height: 200px;
            margin-top: 20px;
            padding-bottom: 30px;
            position: relative;
        }
        
        .chart-bar {
            width: 40px;
            background-color: var(--grab-green);
            border-radius: 4px 4px 0 0;
            position: relative;
            margin: 0 5px;
        }
        
        .chart-value {
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 12px;
            font-weight: 500;
            white-space: nowrap;
        }
        
        .chart-label {
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 12px;
            white-space: nowrap;
        }
        
        /* Pie Chart Styles */
        .pie-chart-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 20px;
        }
        
        .pie-chart {
            width: 200px;
            height: 200px;
            position: relative;
            border-radius: 50%;
            background: conic-gradient(
                #4285F4 0% 30%, 
                #34A853 30% 55%, 
                #FBBC05 55% 77%, 
                #EA4335 77% 100%
            );
            margin-bottom: 20px;
        }
        
        .pie-legend {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 12px;
        }
        
        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 2px;
        }

        .action-button {
            width: 100%;
            padding: 12px;
            background-color: var(--grab-green);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 14px;
        }

        .action-button:hover {
            background-color: var(--grab-green-dark);
            transform: translateY(-1px);
        }

        .action-button.secondary {
            background-color: var(--light-gray-bg);
            color: var(--secondary-text);
        }

        .action-button.secondary:hover {
            background-color: #e5e5e5;
        }

        .action-button i {
            font-size: 14px;
        }

        /* Popup Styles */
        .visual-popup {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
        }

        .popup-content {
            background: white;
            width: 90%;
            max-width: 350px;
            max-height: 90%;
            border-radius: 20px;
            padding: 20px;
            position: relative;
            overflow: hidden;
            animation: popupFadeIn 0.3s ease-out;
        }

        .popup-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .popup-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--soft-black);
        }

        .popup-close {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--light-gray-bg);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .popup-close:hover {
            background: var(--border-color);
        }

        .popup-body {
            overflow-y: auto;
            max-height: calc(100vh - 200px);
            padding-right: 10px;
        }

        .popup-visual {
            width: 100%;
            transform-origin: center;
            transition: transform 0.3s ease;
            touch-action: manipulation;
        }

        .zoom-controls {
            position: absolute;
            bottom: 20px;
            right: 20px;
            display: flex;
            gap: 8px;
        }

        .zoom-button {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: var(--grab-green);
            color: white;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background-color 0.2s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .zoom-button:hover {
            background: var(--grab-green-dark);
        }

        @keyframes popupFadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
    </style>
</head>
<body>
    <div class="phone-mockup">
        <div class="chat-app">
            <div class="chat-header">
            <div class="back-button" onclick="showAlertList()">
                <i class="fas fa-chevron-left"></i>
            </div>
                <div class="avatar"></div>
            <div class="header-title">Grab Assistant AI</div>
            <div class="reset-button chat-ui-only" onclick="resetChatMessages()" title="Reset Chat" style="display: none;">
                <i class="fas fa-redo-alt"></i>
            </div>
        
            <div class="language-selector main-ui-only" onclick="toggleLanguageDropdown()" style="display: block;">
                <div class="language-icon">
                    <i class="fas fa-globe-asia"></i>
                </div>
            </div>
        </div>

        <!-- Maintain the language icon functionality for the main UI -->
        <div class="language-overlay" id="language-overlay"></div>
        <div class="language-dropdown" id="language-dropdown">
            <div class="language-option language-selected" onclick="selectLanguage('English', 'en')">
                <img src="https://flagcdn.com/w160/gb.png" class="language-flag" alt="English">
                <div class="language-name">English</div>
            </div>
            <div class="language-option" onclick="selectLanguage('Bahasa Indonesia', 'id')">
                <img src="https://flagcdn.com/w160/id.png" class="language-flag" alt="Indonesia">
                <div class="language-name">Bahasa Indonesia</div>
            </div>
            <div class="language-option" onclick="selectLanguage('Bahasa Melayu', 'ms')">
                <img src="https://flagcdn.com/w160/my.png" class="language-flag" alt="Malaysia">
                <div class="language-name">Bahasa Melayu</div>
            </div>
            <div class="language-option" onclick="selectLanguage('Ting Vit', 'vi')">
                <img src="https://flagcdn.com/w160/vn.png" class="language-flag" alt="Vietnam">
                <div class="language-name">Ting Vit</div>
            </div>
            <div class="language-option" onclick="selectLanguage('', 'th')">
                <img src="https://flagcdn.com/w160/th.png" class="language-flag" alt="Thailand">
                <div class="language-name"></div>
            </div>
            <div class="language-option" onclick="selectLanguage('Filipino', 'fil')">
                <img src="https://flagcdn.com/w160/ph.png" class="language-flag" alt="Philippines">
                <div class="language-name">Filipino</div>
            </div>
            <div class="language-option" onclick="selectLanguage('', 'my')">
                <img src="https://flagcdn.com/w160/mm.png" class="language-flag" alt="Myanmar">
                <div class="language-name"></div>
            </div>
            <div class="language-option" onclick="selectLanguage('', 'km')">
                <img src="https://flagcdn.com/w160/kh.png" class="language-flag" alt="Cambodia">
                <div class="language-name"></div>
            </div>        </div>
        
        <div class="chat-list">
                <!-- Chat with AI -->
                <div class="chat-item" onclick="showAIChat()">
                    <div class="chat-item-header">
                        <div class="chat-icon">
                            <i class="fas fa-robot"></i>
                        </div>
                        <div class="chat-title">Chat with AI</div>
                    </div>
                    <div class="chat-preview">
                        Ask me anything about your business or make custom requests
                    </div>
                </div>

            <!-- Inventory Alert -->
            <div class="chat-item pro-version" onclick="showInventoryChat()">
                <div class="pro-badge">
                    <i class="fas fa-crown"></i>
                    PRO
                </div>
                <div class="chat-item-header">
                    <div class="chat-icon">
                        <i class="fas fa-box"></i>
                    </div>
                    <div class="chat-title">AI Stock</div>
    
                </div>
                <div class="chat-preview">
                    Low stock warning: Flour (25kg remaining), Eggs (2 trays remaining)
                </div>
                <div class="chat-time">5 mins ago</div>
            </div>

            <!-- Business Insights -->
            <div class="chat-item pro-version" onclick="showInsightsChat()">
                <div class="pro-badge">
                    <i class="fas fa-crown"></i>
                    PRO
                </div>
                <div class="chat-item-header">
                    <div class="chat-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div class="chat-title">AI Business Insights</div>
                </div>
                <div class="chat-preview">
                    Today's revenue is up 15% compared to last Tuesday. Peak hours expected between 7-9 AM.
                </div>
                <div class="chat-time">15 mins ago</div>
            </div>

            <!-- Promotions -->
            <div class="chat-item pro-version" onclick="showPromotionsChat()">
                <div class="pro-badge">
                    <i class="fas fa-crown"></i>
                    PRO
                </div>
                <div class="chat-item-header">
                    <div class="chat-icon">
                        <i class="fas fa-bullhorn"></i>
                    </div>
                    <div class="chat-title">AI Promotions</div>
                </div>
                <div class="chat-preview">
                    Suggested: Create a breakfast combo deal to boost morning sales
                </div>
                <div class="chat-time">1 hour ago</div>
            </div>
        </div>

        <!-- Chat Interface -->
            <div class="chat-messages" id="chat-messages" style="display: none;">
                <!-- Messages will be added here dynamically -->
            </div>
            
            <div class="input-area" id="input-area" style="display: none;">
                <input type="text" class="input-field" placeholder="Type your message..." id="chat-input">
                <button class="mic-button" onclick="toggleRecording()" id="mic-button">
                    <i class="fas fa-microphone"></i>
                </button>
                <button class="send-button" onclick="sendMessage()">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </div>

    <script>
        // Add these variables at the top of the script
        let currentChat = null;
        const chatMessages = document.getElementById('chat-messages');
        const chatInput = document.getElementById('chat-input');
        const inputArea = document.getElementById('input-area');
        const backButton = document.querySelector('.back-button');
        const headerTitle = document.querySelector('.header-title');
        const chatList = document.querySelector('.chat-list');
        const avatar = document.querySelector('.avatar');
        // Voice interaction variables
        let isRecording = false;
        let currentVoiceStep = 0;
        

        // Kedahan slang predefined prompts and responses
        const kedahanPrompts = [
            "hang cek sat mana brg aku tak lu", // Step 5
            "buang aje la" // Step 7
        ];
        
        const kedahanResponses = [
            "Menurut analisis saya, Roti Planta anda tidak mempunyai sebarang jualan sepanjang bulan ini. Cadangan saya adalah untuk membuangnya kerana ia tidak mendapat sambutan tinggi pada keseluruhan pasaran. Hal ini dapat mengurangkan perbaziran pada stock", // Step 6
            "Baiklah, saya akan membuangnya" // Step 8
        ];
        
        // Add conversation state tracking
        let conversationStep = 0;
        let chatHistory = {
            ai: [],
            inventory: [],
            insights: [],
            promotions: []
        };

        // Add function to save chat history
        function saveChatHistory() {
            localStorage.setItem('chatHistory', JSON.stringify(chatHistory));
        }

        // Add function to load chat history
        function loadChatHistory() {
            const savedHistory = localStorage.getItem('chatHistory');
            if (savedHistory) {
                chatHistory = JSON.parse(savedHistory);
            }
        }

        // Initialize chat history when the page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Clear any existing chat history when the page loads
            localStorage.removeItem('chatHistory');
            chatHistory = {
                ai: [],
                inventory: [],
                insights: [],
                promotions: []
            };
            
            // Check for saved language preference
            const savedLanguage = localStorage.getItem('selectedLanguage');
            if (savedLanguage === 'Bahasa Melayu') {
                currentLanguage = 'Bahasa Melayu';
                translateToBahasaMelayu();
                
                // Update the selected language in the dropdown
                const options = document.querySelectorAll('.language-option');
                options.forEach(option => {
                    option.classList.remove('language-selected');
                });
                
                const selectedOption = document.querySelector(`.language-option[onclick*="Bahasa Melayu"]`);
                if (selectedOption) {
                    selectedOption.classList.add('language-selected');
                }
            }
        });

        // Function to reset chat messages but preserve conversation flow
        function resetChatMessages() {
            // Clear the chat messages display
            chatMessages.innerHTML = '';
            
            // Clear the chat history for the current chat
            if (currentChat) {
                chatHistory[currentChat] = [];
                saveChatHistory();
            }
            
            // Display welcome message without saving to history
            const currentLanguage = localStorage.getItem('selectedLanguage') || 'English';
            let welcomeMessage = '';
            
            if (currentChat === 'ai') {
            if (currentLanguage === 'Bahasa Melayu') {
                welcomeMessage = 'Hai Anas!  Bersedia untuk memeriksa Roti Canai King? Apa yang boleh saya bantu hari ini?';
            } else {
                welcomeMessage = 'Hi Anas!  Ready to check on Roti Canai King? What can I help you with today?';
            }
                addMessage(welcomeMessage, false, false); // false for isUser, false for saveToHistory
            } else if (currentChat === 'inventory') {

                const menuSuggestion = `
                    <p style="color: var(--grab-green-dark); font-weight: 500; margin-bottom: 12px;">Menu Performance Analysis</p>

                            <div style="background-color: var(--grab-green-light); border-radius: 12px; padding: 15px; margin-top: 12px;">
                                <div style="display: flex; align-items: center; margin-bottom: 10px;">
                                    <div style="width: 30px; height: 30px; border-radius: 50%; background-color: var(--grab-green); display: flex; align-items: center; justify-content: center; margin-right: 10px;">
                                        <i class="fas fa-utensils" style="color: white; font-size: 14px;"></i>
                                    </div>
                                    <div style="font-weight: 600; color: var(--grab-green-dark);">Roti Canai Cheese Deluxe</div>
                                </div>
                                <div style="display: flex; align-items: center; margin-bottom: 10px;">
                                    <div style="width: 30px; height: 30px; border-radius: 50%; background-color: var(--grab-green); display: flex; align-items: center; justify-content: center; margin-right: 10px;">
                                        <i class="fas fa-tag" style="color: white; font-size: 14px;"></i>
                                    </div>
                                    <div style="font-weight: 600; color: var(--grab-green-dark);">RM .90/div>
                                </div>
                                <div style="display: flex; align-items: center;">
                                    <div style="width: 30px; height: 30px; border-radius: 50%; background-color: var(--grab-green); display: flex; align-items: center; justify-content: center; margin-right: 10px;">
                                        <i class="fas fa-layer-group" style="color: white; font-size: 14px;"></i>
                                    </div>
                                    <div style="font-weight: 600; color: var(--grab-green-dark);">Combo Set</div>
                                </div>
                            </div>
                        `;
                addMessage(menuSuggestion, false, false);
            } else if (currentChat === 'insights') {
                addMessage("Here's your weekly business report:", false, false);
                showWeeklyBusinessReport();
            } else if (currentChat === 'promotions') {
                addMessage("I can help you create and manage promotions. What would you like to do?", false, false);
            }
        }

        // Language variables
        let currentLanguage = 'English';
        const translations = {
            'Bahasa Melayu': {
                'Grab Assistant AI': 'Grab Assistant AI',
                'Chat with AI': 'Berbual dengan AI',
                'Inventory Management': 'Pengurusan Inventori',
                'AI Business Insights': 'AI Wawasan Perniagaan',
                'AI Promotions': 'AI Promosi',
                'Ask me anything about your business or make custom requests': 'Tanya saya apa-apa tentang perniagaan anda atau buat permintaan khas',
                'Low stock warning': 'Amaran stok rendah',
                'Today\'s revenue is up': 'Pendapatan hari ini meningkat',
                'Suggested': 'Dicadangkan',
                'Type your message...': 'Taip mesej anda...',
                'Just now': 'Baru sahaja',
                '15 mins ago': '15 minit yang lalu',
                '1 hour ago': '1 jam yang lalu',
                'Reorder now': 'Pesan semula sekarang',
                'Dismiss': 'Tutup',
                'Your stock of tomatoes is low. Would you like to reorder now?': 'Stok tomato anda rendah. Adakah anda ingin memesan semula sekarang?',
                'AI Stock': 'AI Stok',
                'Weekly Performance Overview': 'Gambaran Prestasi Mingguan',
                'remaining': 'baki',
                'Weekly Business Report': 'Laporan Perniagaan Mingguan',
                'Overview': 'Gambaran Keseluruhan',
                'Sales': 'Jualan',
                'Inventory': 'Inventori',
                'Download PDF': 'Muat Turun PDF',
                'Close': 'Tutup',
                'Sales Performance': 'Prestasi Jualan',
                'Top Selling Items': 'Item Terlaris',
                'Customer Satisfaction': 'Kepuasan Pelanggan',
                'Revenue': 'Pendapatan',
                'Orders': 'Pesanan',
                'Average Order': 'Purata Pesanan'
            }
        };

        // Language selector functions
        function toggleLanguageDropdown() {
            const dropdown = document.getElementById('language-dropdown');
            const overlay = document.getElementById('language-overlay');
            
            dropdown.classList.toggle('active');
            overlay.classList.toggle('active');
            
            // Close dropdown when clicking outside
            overlay.onclick = function() {
                dropdown.classList.remove('active');
                overlay.classList.remove('active');
            };
        }
        
        function selectLanguage(languageName, languageCode) {
            currentLanguage = languageName;
            
            // Save selected language to localStorage
            localStorage.setItem('selectedLanguage', languageName);
            
            // Close the dropdown
            const dropdown = document.getElementById('language-dropdown');
            const overlay = document.getElementById('language-overlay');
            dropdown.classList.remove('active');
            overlay.classList.remove('active');
            
            // Update the selected language in the dropdown
            const options = document.querySelectorAll('.language-option');
            options.forEach(option => {
                option.classList.remove('language-selected');
            });
            
            const selectedOption = document.querySelector(`.language-option[onclick*="${languageName}"]`);
            if (selectedOption) {
                selectedOption.classList.add('language-selected');
            }
            
            // Translate the UI based on selected language
            if (languageName === 'Bahasa Melayu') {
                translateToBahasaMelayu();
            } else {
                translateToEnglish();
            }
            
            // If currently in AI chat, refresh the welcome message
            if (currentChat === 'ai') {
                // Clear chat history to force displaying the welcome message again
                chatHistory.ai = [];
                // Show AI chat again with the new language
                showAIChat();
            }
        }
        
        // Translation functions
        function translateToBahasaMelayu() {
            // Translate header
            const headerTitle = document.querySelector('.header-title');
            if (headerTitle) {
                headerTitle.textContent = translations['Bahasa Melayu']['Grab Assistant AI'] || headerTitle.textContent;
            }
            
            // Translate chat items
            const chatItems = document.querySelectorAll('.chat-item');
            chatItems.forEach(item => {
                const title = item.querySelector('.chat-title');
                const preview = item.querySelector('.chat-preview');
                const time = item.querySelector('.chat-time');
                
                if (title) {
                    const originalText = title.textContent;
                    const translated = translations['Bahasa Melayu'][originalText];
                    if (translated) {
                        title.textContent = translated;
                    }
                }
                
                if (time) {
                    const originalTime = time.textContent;
                    const translated = translations['Bahasa Melayu'][originalTime];
                    if (translated) {
                        time.textContent = translated;
                    }
                }
                
                if (preview) {
                    // Handle complex preview texts with special cases
                    if (preview.textContent.includes('Low stock warning:')) {
                        const parts = preview.textContent.split(':');
                        const warning = translations['Bahasa Melayu']['Low stock warning'] || 'Low stock warning';
                        const items = parts[1].split(',').map(item => {
                            // Replace "remaining" with its translation
                            return item.replace('remaining', translations['Bahasa Melayu']['remaining'] || 'remaining');
                        }).join(',');
                        preview.textContent = `${warning}: ${items}`;
                    } else if (preview.textContent.includes('Today\'s revenue is up')) {
                        const parts = preview.textContent.split('compared');
                        const revenue = translations['Bahasa Melayu']['Today\'s revenue is up'] || 'Today\'s revenue is up';
                        preview.textContent = `${revenue} 15% berbanding hari Selasa lepas. Waktu puncak dijangka antara 7-9 pagi.`;
                    } else if (preview.textContent.includes('Suggested:')) {
                        const parts = preview.textContent.split(':');
                        const suggested = translations['Bahasa Melayu']['Suggested'] || 'Suggested';
                        preview.textContent = `${suggested}: Cipta pakej sarapan untuk meningkatkan jualan pagi`;
                    } else if (preview.textContent.includes('Ask me anything')) {
                        preview.textContent = translations['Bahasa Melayu']['Ask me anything about your business or make custom requests'] || preview.textContent;
                    }
                }
            });
            
            // Translate input placeholder
            const chatInput = document.getElementById('chat-input');
            if (chatInput) {
                chatInput.placeholder = translations['Bahasa Melayu']['Type your message...'] || 'Type your message...';
            }
            
            // Translate business report elements if they exist
            const reportTitle = document.querySelector('.report-title');
            if (reportTitle) {
                reportTitle.textContent = translations['Bahasa Melayu']['Weekly Business Report'] || reportTitle.textContent;
            }
            
            // Translate tabs
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => {
                const originalText = tab.textContent.trim();
                const translated = translations['Bahasa Melayu'][originalText];
                if (translated) {
                    tab.textContent = translated;
                }
            });
            
            // Translate buttons
            const buttons = document.querySelectorAll('button');
            buttons.forEach(button => {
                const originalText = button.textContent.trim();
                const translated = translations['Bahasa Melayu'][originalText];
                if (translated) {
                    button.textContent = translated;
                }
            });
            
            // Translate section titles
            const sectionTitles = document.querySelectorAll('.report-section h4');
            sectionTitles.forEach(title => {
                const originalText = title.textContent.trim();
                const translated = translations['Bahasa Melayu'][originalText];
                if (translated) {
                    title.textContent = translated;
                }
            });
            
            // Translate metric titles
            const metricTitles = document.querySelectorAll('.metric-title');
            metricTitles.forEach(title => {
                const originalText = title.textContent.trim();
                const translated = translations['Bahasa Melayu'][originalText];
                if (translated) {
                    title.textContent = translated;
                }
            });
        }
        
        function translateToEnglish() {
            // Reset header to English
            const headerTitle = document.querySelector('.header-title');
            if (headerTitle) {
                headerTitle.textContent = 'Grab Assistant AI';
            }
            
            // Reset chat items to English
            const chatItems = document.querySelectorAll('.chat-item');
            chatItems.forEach(item => {
                const title = item.querySelector('.chat-title');
                const preview = item.querySelector('.chat-preview');
                const time = item.querySelector('.chat-time');
                
                if (title) {
                    // Reset titles to English based on Bahasa Melayu values
                    for (const [engKey, malayValue] of Object.entries(translations['Bahasa Melayu'])) {
                        if (title.textContent === malayValue) {
                            title.textContent = engKey;
                            break;
                        }
                    }
                }
                
                if (time) {
                    // Reset times to English based on Bahasa Melayu values
                    for (const [engKey, malayValue] of Object.entries(translations['Bahasa Melayu'])) {
                        if (time.textContent === malayValue) {
                            time.textContent = engKey;
                            break;
                        }
                    }
                }
                
                if (preview) {
                    // Reset preview texts to English based on which chat item it is
                    if (item.querySelector('.chat-title').textContent === 'Chat with AI') {
                        preview.textContent = 'Ask me anything about your business or make custom requests';
                    } else if (item.querySelector('.chat-title').textContent === 'AI Stock') {
                        preview.textContent = 'Low stock warning: Flour (25kg remaining), Eggs (2 trays remaining)';
                    } else if (item.querySelector('.chat-title').textContent === 'AI Business Insights') {
                        preview.textContent = 'Today\'s revenue is up 15% compared to last Tuesday. Peak hours expected between 7-9 AM.';
                    } else if (item.querySelector('.chat-title').textContent === 'AI Promotions') {
                        preview.textContent = 'Suggested: Create a breakfast combo deal to boost morning sales';
                    }
                }
            });
            
            // Reset input placeholder to English
            const chatInput = document.getElementById('chat-input');
            if (chatInput) {
                chatInput.placeholder = 'Type your message...';
            }
            
            // Reset business report elements to English
            const reportTitle = document.querySelector('.report-title');
            if (reportTitle) {
                reportTitle.textContent = 'Weekly Business Report';
            }
            
            // Reset tabs to English
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => {
                const malayText = tab.textContent.trim();
                for (const [engKey, malayValue] of Object.entries(translations['Bahasa Melayu'])) {
                    if (malayText === malayValue) {
                        tab.textContent = engKey;
                        break;
                    }
                }
            });
            
            // Reset buttons to English
            const buttons = document.querySelectorAll('button');
            buttons.forEach(button => {
                const malayText = button.textContent.trim();
                for (const [engKey, malayValue] of Object.entries(translations['Bahasa Melayu'])) {
                    if (malayText === malayValue) {
                        button.textContent = engKey;
                        break;
                    }
                }
            });
            
            // Reset section titles to English
            const sectionTitles = document.querySelectorAll('.report-section h4');
            sectionTitles.forEach(title => {
                const malayText = title.textContent.trim();
                for (const [engKey, malayValue] of Object.entries(translations['Bahasa Melayu'])) {
                    if (malayText === malayValue) {
                        title.textContent = engKey;
                        break;
                    }
                }
            });
            
            // Reset metric titles to English
            const metricTitles = document.querySelectorAll('.metric-title');
            metricTitles.forEach(title => {
                const malayText = title.textContent.trim();
                for (const [engKey, malayValue] of Object.entries(translations['Bahasa Melayu'])) {
                    if (malayText === malayValue) {
                        title.textContent = engKey;
                        break;
                    }
                }
            });
        }

        // Modify showAIChat to properly handle chat history
        function showAIChat() {
            currentChat = 'ai';
            showChat('Chat with AI');
            
            // Clear existing messages
            chatMessages.innerHTML = '';
            
            // Always show initial welcome message based on selected language
            const currentLanguage = localStorage.getItem('selectedLanguage') || 'English';
            let welcomeMessage = '';
            
            if (currentLanguage === 'Bahasa Melayu') {
                // Set welcome message in Malay
                welcomeMessage = 'Hai Anas!  Bersedia untuk memeriksa Roti Canai King? Apa yang boleh saya bantu hari ini?';
            } else {
                // Set welcome message in English
                welcomeMessage = 'Hi Anas!  Ready to check on Roti Canai King? What can I help you with today?';
            }
            
            // Display welcome message (without adding to history)
            const welcomeDiv = document.createElement('div');
            welcomeDiv.className = 'message';
            
            const welcomeBubble = document.createElement('div');
            welcomeBubble.className = 'bubble';
            welcomeBubble.textContent = welcomeMessage;
            
            // Get current time for timestamp
            const now = new Date();
            const timeString = now.toLocaleTimeString('en-US', { 
                hour: 'numeric', 
                minute: '2-digit',
                hour12: true 
            });
            
            // Add timestamp
            const timestampDiv = document.createElement('div');
            timestampDiv.className = 'timestamp';
            timestampDiv.textContent = timeString;
            welcomeBubble.appendChild(timestampDiv);
            
            welcomeDiv.appendChild(welcomeBubble);
            chatMessages.appendChild(welcomeDiv);
            
            // Load and display saved history after the welcome message
            if (chatHistory.ai && chatHistory.ai.length > 0) {
                // Display all saved messages
                chatHistory.ai.forEach(msg => {
                    const messageDiv = document.createElement('div');
                    messageDiv.className = `message ${msg.isUser ? 'user' : 'ai'}`;
                    
                    const bubbleDiv = document.createElement('div');
                    bubbleDiv.className = 'bubble';
                    
                    if (msg.text.includes('<div') || msg.text.includes('<span') || msg.text.includes('<button')) {
                        bubbleDiv.innerHTML = msg.text;
                    } else {
                        bubbleDiv.textContent = msg.text;
                    }
                    
                    // Add timestamp
                    const timestampDiv = document.createElement('div');
                    timestampDiv.className = 'timestamp';
                    timestampDiv.textContent = msg.timestamp;
                    bubbleDiv.appendChild(timestampDiv);
                    
                    messageDiv.appendChild(bubbleDiv);
                    chatMessages.appendChild(messageDiv);
                });
                
                // Set conversation step based on last message
                const lastMessage = chatHistory.ai[chatHistory.ai.length - 1].text.toLowerCase();
                if (lastMessage.includes('yes') && lastMessage.includes('add')) {
                    conversationStep = 3;
                } else if (lastMessage.includes('roti canai cheese deluxe')) {
                    conversationStep = 2;
                } else if (lastMessage.includes('add') && (lastMessage.includes('menu') || lastMessage.includes('item'))) {
                    conversationStep = 1;
                }
            }
        }

        // Modify addMessage to properly save to history
        function addMessage(text, isUser, saveToHistory = true) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user' : 'ai'}`;
            
            const bubble = document.createElement('div');
            bubble.className = 'bubble';
            bubble.innerHTML = text;

            // Add timestamp
            const now = new Date();
            const timeString = now.toLocaleTimeString('en-US', { 
                hour: 'numeric', 
                minute: '2-digit',
                hour12: true 
            });

                const timestampDiv = document.createElement('div');
                timestampDiv.className = 'timestamp';
                timestampDiv.textContent = timeString;
            bubble.appendChild(timestampDiv);
            
            messageDiv.appendChild(bubble);
            chatMessages.appendChild(messageDiv);
            
            // Scroll to bottom
           

            // Save message to history if saveToHistory is true
            if (saveToHistory && currentChat) {
                if (!chatHistory[currentChat]) {
                    chatHistory[currentChat] = [];
                }
                chatHistory[currentChat].push({
                    text: text,
                    isUser: isUser,
                    timestamp: timeString
                });
                saveChatHistory();
            }

            return messageDiv;
        }

        function showAlertList() {
            chatList.style.display = 'block';
            chatMessages.style.display = 'none';
            inputArea.style.display = 'none';
            backButton.style.display = 'none';
            headerTitle.textContent = 'Grab Assistant AI';
            avatar.style.display = 'flex';
            currentChat = null;
            chatMessages.innerHTML = '';

            // Adjust button visibility for Main UI
            const resetButton = document.querySelector('.reset-button');
            const languageSelector = document.querySelector('.language-selector');
            if (resetButton) resetButton.style.display = 'none';
            if (languageSelector) languageSelector.style.display = 'block';
        }

        function showChat(title) {
            chatList.style.display = 'none';
            chatMessages.style.display = 'flex';
            inputArea.style.display = 'flex';
            backButton.style.display = 'block';
            
            // Translate the title based on selected language
            const savedLanguage = localStorage.getItem('selectedLanguage');
            let translatedTitle = title;
            if (savedLanguage === 'Bahasa Melayu') {
                const translations = {
                    'Chat with AI': 'Berbual dengan AI',
                    'AI Business Insights': 'AI Wawasan Perniagaan',
                    'AI Stock': 'AI Stok',
                    'AI Promotions': 'AI Promosi'
                };
                translatedTitle = translations[title] || title;
            }
            headerTitle.textContent = translatedTitle;
            
            // Hide avatar for chat UIs
            const avatar = document.querySelector('.avatar');
            if (avatar) {
                if (title === 'Chat with AI' || title === 'Business Insights' || title === 'AI Stock' || title === 'Promotions') {
                    avatar.style.display = 'none';
                } else {
                    avatar.style.display = 'flex';
                }
    
            }
            
            chatMessages.innerHTML = '';

            // Adjust button visibility based on the current UI
            const resetButton = document.querySelector('.reset-button');
            const languageSelector = document.querySelector('.language-selector');
            if (title === 'Chat with AI' || title === 'Business Insights' || title === 'Stock' || title === 'Promotions') {
                if (resetButton) resetButton.style.display = 'block';
                if (languageSelector) languageSelector.style.display = 'none';
            } else {
                if (resetButton) resetButton.style.display = 'none';
                if (languageSelector) languageSelector.style.display = 'block';
            }

            // Focus on the input field
            setTimeout(() => {
                chatInput.focus();
            }, 100);
        }

        function showTypingIndicator() {
            const typingDiv = document.createElement('div');
            typingDiv.classList.add('message', 'ai', 'typing-indicator');
            typingDiv.id = 'typing-indicator';
            // Give it bubble structure for consistency
            typingDiv.innerHTML = `<div class="bubble"><div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div></div>`;
            chatMessages.appendChild(typingDiv);
            // Ensure animation starts correctly
            requestAnimationFrame(() => {
                requestAnimationFrame(() => {
                    typingDiv.style.opacity = 1;
                    typingDiv.style.transform = 'translateY(0)';
                });
            });
            chatMessages.scrollTop = chatMessages.scrollHeight;
            return typingDiv;
        }

        function hideTypingIndicator() {
            const indicator = document.getElementById('typing-indicator');
            if (indicator) {
                // Optional: Fade out before removing for smoother transition
                indicator.style.transition = 'opacity 0.3s ease';
                indicator.style.opacity = 0;
                setTimeout(() => indicator.remove(), 300);
            }
        }

        function sendMessage() {
            const message = chatInput.value.trim();
            if (message) {
                addMessage(message, true);
                chatInput.value = '';
                // Handle user message based on current chat
                handleUserMessage(message);
            } else {
                // If no message is entered, send a predefined dummy prompt based on conversation step
                if (currentChat === 'ai') {
                    // For AI chat, send predefined messages in sequence
                    if (conversationStep === 0) {
                        addMessage("I want to add a new menu item to my restaurant", true);
                        handleUserMessage("I want to add a new menu item to my restaurant");
                        conversationStep = 1;
                    } else if (conversationStep === 1) {
                        addMessage("Roti Canai Cheese Deluxe, RM 4.90, Signature Items", true);
                        handleUserMessage("Roti Canai Cheese Deluxe, RM 4.90, Signature Items");
                        conversationStep = 2;
                    } else if (conversationStep === 2) {
                        addMessage("Yes, please add it", true);
                        handleUserMessage("Yes, please add it");
                        conversationStep = 3;
                    } else if (conversationStep === 3) {
                        addMessage("What's this month's business performance?", true);
                        handleUserMessage("What's this month's business performance?");
                        conversationStep = 4;
                    } else if (conversationStep === 4) {
                        addMessage("Okay...so how can I improve weekend sales?", true);
                        handleUserMessage("Okay...so how can I improve weekend sales?");
                        conversationStep = 5;
                    } else if (conversationStep === 5) {
                        addMessage("Can you give me more details about the top selling items?", true);
                        handleUserMessage("Can you give me more details about the top selling items?");
                        conversationStep = 6;
                    } else if (conversationStep === 6) {
                        addMessage("What should I do if I run out of eggs?", true);
                        handleUserMessage("What should I do if I run out of eggs?");
                        conversationStep = 0; // Reset to start
                    }
                } else if (currentChat === 'inventory') {
                    // For inventory chat, send predefined messages in sequence
                    if (conversationStep === 0) {
                        addMessage("Yes, I'd like to place an order", true);
                        handleUserMessage("Yes, I'd like to place an order");
                        conversationStep = 1;
                    } else if (conversationStep === 1) {
                        addMessage("I need 50kg of flour and 5 trays of eggs", true);
                        handleUserMessage("I need 50kg of flour and 5 trays of eggs");
                        conversationStep = 0; // Reset to start
                    }
                } else if (currentChat === 'insights') {
                    // For insights chat, send predefined messages in sequence
                    if (conversationStep === 0) {
                        addMessage("What's this month's business performance?", true);
                        handleUserMessage("What's this month's business performance?");
                        conversationStep = 1;
                    } else if (conversationStep === 1) {
                        addMessage("Can you give me more details about the top selling items?", true);
                        handleUserMessage("Can you give me more details about the top selling items?");
                        conversationStep = 0; // Reset to start
                    }
                } else if (currentChat === 'promotions') {
                    // For promotions chat, send predefined messages in sequence
                    if (conversationStep === 0) {
                        addMessage("Create a new promotion", true);
                        handleUserMessage("Create a new promotion");
                        conversationStep = 1;
                    } else if (conversationStep === 1) {
                        addMessage("A breakfast combo deal sounds good", true);
                        handleUserMessage("A breakfast combo deal sounds good");
                        conversationStep = 0; // Reset to start
                    }
                }
            }
        }

        function handleUserMessage(message) {
            switch(currentChat) {
                case 'inventory':
                    handleInventoryResponse(message);
                    break;
                case 'insights':
                    handleInsightsResponse(message);
                    break;
                case 'promotions':
                    handlePromotionsResponse(message);
                    break;
                case 'ai':
                    handleAIResponse(message);
                    break;
            }
        }

        function showPromotionConfirmation() {
            const duration = document.getElementById('promotion-duration').value;
            const audience = document.getElementById('target-audience').value;
            const totalPrice = duration * 5;

            const confirmationHtml = `
                <div>
                    <div style="background: var(--grab-green-light); padding: 15px; border-radius: 12px; margin-bottom: 15px;">
                        <p style="margin: 0 0 10px 0; font-weight: 500; color: var(--grab-green-dark);">Promotion Summary:</p>
                        <ul style="margin: 0; padding-left: 20px; color: var(--soft-black);">
                            <li>Target: ${audience.replace(/^\w/, c => c.toUpperCase())} Customers</li>
                            <li>Duration: ${duration} days</li>
                            <li>Total Price: RM${totalPrice}</li>
                        </ul>
                    </div>
                    <p>Are you sure you want to proceed with this promotion?</p>
                    <div style="display: flex; gap: 10px;">
                        <button onclick="confirmPromotion()" class="action-button">
                            <i class="fas fa-check"></i> Yes, Confirm
                        </button>
                        <button onclick="cancelPromotion()" class="action-button secondary">
                            <i class="fas fa-times"></i> Cancel
                        </button>
                    </div>
                </div>
            `;
            addMessage(confirmationHtml);
        }

        // Inventory Chat
        function showInventoryChat() {
            currentChat = 'inventory';
            showChat('AI Stock');
            
            // Add the Proactive Inventory AI flow
            // Step 1: Detect Low or High Stock
            addMessage('Heads up, your <strong>Roti Planta sales are rising like never before.</strong> It is at an increasing pace of 13 orders per day for this week! I will set a reminder for you to check your stock, this helps prevent <strong>Lost sales</strong>', false);
            
            // Step 2: Offer Action Options
            const actionOptionsHtml = `
                <div style="margin-top: 10px;">
                    <p>Would you like to:</p>
                    <ul style="list-style-type: none; padding-left: 10px; margin-top: 8px;">
                        <li style="margin-bottom: 5px;"> Restock now</li>
                        <li style="margin-bottom: 5px;"> Set a reminder</li>
                    </ul>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 15px;">
                    <button onclick="showPromoteForm()" style="flex: 1; padding: 8px; background-color: var(--grab-green); color: white; border: none; border-radius: 6px; font-weight: 500; cursor: pointer;">Promote</button>
                    <button onclick="setInventoryReminder()" style="flex: 1; padding: 8px; background-color: var(--grab-green); color: white; border: none; border-radius: 6px; font-weight: 500; cursor: pointer;">Set Reminder</button>
                    <button onclick="dismissInventoryAlert()" style="flex: 1; padding: 8px; background-color: #e0e0e0; color: #333; border: none; border-radius: 6px; font-weight: 500; cursor: pointer;">Dismiss</button>
                </div>
            `;
            addMessage(actionOptionsHtml, false);
            
            // Also show the standard inventory message from the previous version
            setTimeout(() => {
                const menuSuggestion = `
                    <p style="color: var(--grab-green-dark); font-weight: 500; margin-bottom: 12px;">Menu Suggestion</p>

                    <p>Introducing the <strong>"Roti Canai Special & Teh Tarik Combo"</strong>  a delicious pairing where customers save RM1.40! Since many customers tend to order these items separately, offering them as a combo not only provides a tasty and satisfying meal but also gives them a great deal</p>

                            <div style="background: var(--grab-green-light); padding: 12px; border-radius: 8px; margin-top: 8px;">

                                        <div style="background-color: var(--grab-green-light); border-radius: 12px; padding: 15px; margin-top: 12px;">
                                    <div style="display: flex; align-items: center; margin-bottom: 10px;">
                                        <div style="width: 30px; height: 30px; border-radius: 50%; background-color: var(--grab-green); display: flex; align-items: center; justify-content: center; margin-right: 10px;">
                                            <i class="fas fa-utensils" style="color: white; font-size: 14px;"></i>
                                        </div>
                                        <div style="font-weight: 600; color: var(--grab-green-dark);">Roti Canai Special + Teh Tarik</div>
                                    </div>
                                    <div style="display: flex; align-items: center; margin-bottom: 10px;">
                                        <div style="width: 30px; height: 30px; border-radius: 50%; background-color: var(--grab-green); display: flex; align-items: center; justify-content: center; margin-right: 10px;">
                                            <i class="fas fa-tag" style="color: white; font-size: 14px;"></i>
                                        </div>
                                        <div style="font-weight: 600; color: var(--grab-green-dark);">RM 7.90</div>
                                    </div>
                                    <div style="display: flex; align-items: center;">
                                        <div style="width: 30px; height: 30px; border-radius: 50%; background-color: var(--grab-green); display: flex; align-items: center; justify-content: center; margin-right: 10px;">
                                            <i class="fas fa-layer-group" style="color: white; font-size: 14px;"></i>
                                        </div>
                                        <div style="font-weight: 600; color: var(--grab-green-dark);">Combo Set</div>
                                    </div>
                                    
                                </div>

                        <p><strong>Note:</strong>With the added discount, customers are more likely to choose the combo over ordering separately. Its a win-win! </p>
                        `;
                addMessage(menuSuggestion, false, false);

                
                // Set a timer to show the business insights notification after 5 seconds
                setTimeout(() => {
                    showBusinessInsightNotification();
                }, 7000);
            }, 1000);
        }

        // Additional functions for Inventory AI flow
        function showRestockForm() {
            // Step 3: Restock Setup
            const restockFormHtml = `
                <div style="background: #f9f9f9; padding: 15px; border-radius: 10px; margin-top: 10px;">
                    <div style="font-weight: 500; margin-bottom: 10px;">Restock roti sardin</div>
                    <div style="display: flex; align-items: center; margin-bottom: 12px;">
                        <div style="width: 120px;">Quantity:</div>
                        <div style="flex: 1; position: relative;">
                            <input type="number" value="20" min="1" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 6px;">
                        </div>
                    </div>
                    <div style="display: flex; align-items: center; margin-bottom: 12px;">
                        <div style="width: 120px;">Price per unit:</div>
                        <div style="flex: 1;">
                            <div style="padding: 8px; border: 1px solid #ddd; border-radius: 6px; background: #f0f0f0;">RM 2.50</div>
                        </div>
                    </div>
                    <div style="display: flex; align-items: center; margin-bottom: 12px;">
                        <div style="width: 120px;">Total cost:</div>
                        <div style="flex: 1; font-weight: 500; color: var(--grab-green);">
                            <div style="padding: 8px; border: 1px solid #ddd; border-radius: 6px; background: #f0f0f0;">RM 50.00</div>
                        </div>
                    </div>
                    <div style="display: flex; gap: 10px; margin-top: 15px;">
                        <button onclick="confirmInventoryAction('restock')" style="flex: 1; padding: 8px; background-color: var(--grab-green); color: white; border: none; border-radius: 6px; font-weight: 500; cursor: pointer;">Confirm Restock</button>
                        <button onclick="cancelInventoryAction()" style="flex: 1; padding: 8px; background-color: #e0e0e0; color: #333; border: none; border-radius: 6px; font-weight: 500; cursor: pointer;">Cancel</button>
                    </div>
                </div>
            `;
            addMessage(restockFormHtml, false);
        }

        function showPromoteForm() {
            // Step 3: Promotion Setup
            const promoteFormHtml = `
                <div style="background: #f9f9f9; padding: 15px; border-radius: 10px; margin-top: 10px;">
                    <div style="font-weight: 500; margin-bottom: 10px;">Promote roti sardin</div>
                    <div style="display: flex; align-items: center; margin-bottom: 12px;">
                        <div style="width: 120px;">Discount:</div>
                        <div style="flex: 1; position: relative;">
                            <select style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 6px;">
                                <option>10% off</option>
                                <option>15% off</option>
                                <option>20% off</option>
                                <option>Buy 1 Get 1 Free</option>
                            </select>
                        </div>
                    </div>
                    <div style="display: flex; align-items: center; margin-bottom: 12px;">
                        <div style="width: 120px;">Duration:</div>
                        <div style="flex: 1;">
                            <select style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 6px;">
                                <option>3 days</option>
                                <option>1 week</option>
                                <option>2 weeks</option>
                            </select>
                        </div>
                    </div>
                    <div style="margin-top: 10px; padding: 10px; background: rgba(0, 166, 63, 0.1); border-radius: 6px; font-size: 13px;">
                        <div style="margin-bottom: 5px;">Promoting roti sardin for 3 days will cost RM9. Reach ~200 customers.</div>
                        <div>Estimated sales increase: 15-20 units</div>
                    </div>
                    <div style="display: flex; gap: 10px; margin-top: 15px;">
                        <button onclick="confirmInventoryAction('promote')" style="flex: 1; padding: 8px; background-color: var(--grab-green); color: white; border: none; border-radius: 6px; font-weight: 500; cursor: pointer;">Start Promotion</button>
                        <button onclick="cancelInventoryAction()" style="flex: 1; padding: 8px; background-color: #e0e0e0; color: #333; border: none; border-radius: 6px; font-weight: 500; cursor: pointer;">Cancel</button>
                    </div>
                </div>
            `;
            addMessage(promoteFormHtml, false);
        }

        function setInventoryReminder() {
            const reminderFormHtml = `
                <div style="background: #f9f9f9; padding: 15px; border-radius: 10px; margin-top: 10px;">
                    <div style="font-weight: 500; margin-bottom: 10px;">Set reminder for roti sardin</div>
                    <div style="display: flex; align-items: center; margin-bottom: 12px;">
                        <div style="width: 120px;">Remind me:</div>
                        <div style="flex: 1; position: relative;">
                            <select style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 6px;">
                                <option>Tomorrow</option>
                                <option>In 2 days</option>
                                <option>In 3 days</option>
                                <option>Next week</option>
                            </select>
                        </div>
                    </div>
                    <div style="display: flex; gap: 10px; margin-top: 15px;">
                        <button onclick="confirmInventoryAction('reminder')" style="flex: 1; padding: 8px; background-color: var(--grab-green); color: white; border: none; border-radius: 6px; font-weight: 500; cursor: pointer;">Set Reminder</button>
                        <button onclick="cancelInventoryAction()" style="flex: 1; padding: 8px; background-color: #e0e0e0; color: #333; border: none; border-radius: 6px; font-weight: 500; cursor: pointer;">Cancel</button>
                    </div>
                </div>
            `;
            addMessage(reminderFormHtml, false);
        }

        function dismissInventoryAlert() {
            addMessage('Alert dismissed. I\'ll remind you again when stock reaches 2 units.', false);
        }

        function confirmInventoryAction(actionType) {
            // Step 4: Confirm Action
            const confirmHtml = `
                <div style="margin-top: 10px;">
                    <p>Are you sure you want to proceed?</p>
                    <div style="display: flex; gap: 10px; margin-top: 15px;">
                        <button onclick="completeInventoryAction('${actionType}')" style="flex: 1; padding: 8px; background-color: var(--grab-green); color: white; border: none; border-radius: 6px; font-weight: 500; cursor: pointer;">Yes, Confirm</button>
                        <button onclick="cancelInventoryAction()" style="flex: 1; padding: 8px; background-color: #e0e0e0; color: #333; border: none; border-radius: 6px; font-weight: 500; cursor: pointer;">Cancel</button>
                    </div>
                </div>
            `;
            addMessage(confirmHtml, false);
        }

        function completeInventoryAction(actionType) {
            // Step 5: Final Confirmation
            let confirmationMessage = '';
            
            if (actionType === 'restock') {
                confirmationMessage = 'Done! Your restocking order has been placed. We\'ll keep you updated on the delivery status.';
            } else if (actionType === 'promote') {
                confirmationMessage = 'Done! Your promotion has been scheduled. We\'ll track performance and provide daily updates.';
            } else if (actionType === 'reminder') {
                confirmationMessage = 'Done! Reminder set. I\'ll notify you when it\'s time to check your roti sardin stock again.';
            } else {
                confirmationMessage = 'Done! Inventory action has been scheduled. We\'ll keep you updated if anything changes.';
            }
            
            addMessage(confirmationMessage, false);
        }

        function cancelInventoryAction() {
            addMessage('Action cancelled. Is there anything else you would like to do with your inventory?', false);
        }

        function handleInventoryResponse(message) {
            if (message.toLowerCase().includes('order')) {
                addMessage('I can help you place an order. How many kg of flour and how many trays of eggs would you like?', false);
            }
            else if (message.toLowerCase().includes('roti canai cheese deluxe')) {
                addMessage('Roti Canai Cheese Deluxe is a popular item at Roti Canai King. It is a delicious and creamy cheese-filled pastry that is sure to satisfy your cravings. Would you like to add this item to your order?', false);
            }
            else {
                addMessage('Is there anything else you\'d like to know about your inventory?', false);
            }
        }

        // Insights Chat
        function showInsightsChat() {
            currentChat = 'insights';
            showChat('Business Insights');
                    // Create metrics grid
                    const metricsHtml = `

                    <p>Let's get you started for today's business! Here's a quick forecast:</p>
                        <div class="metrics-grid">
                            <div class="metric-card">
                                <div class="metric-title">Expected Revenue</div>
                                <div class="metric-value">RM 2,800</div>
                                <div class="metric-trend">
                                    <i class="fas fa-arrow-up"></i>12% vs last week
                                </div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-title">Projected Orders</div>
                                <div class="metric-value">180-220</div>
                                <div class="metric-trend">
                                    <i class="fas fa-arrow-up"></i>8% vs last week
                                </div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-title">Peak Hours</div>
                                <div class="metric-value">7-9 AM</div>
                                <div class="metric-trend">12-2 PM</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-title">Best Seller</div>
                                <div class="metric-value">Roti Canai Special</div>
                                <div class="metric-trend">45-50 orders</div>
                            </div>
                        </div>

                        <div class="chart-container">
                            <div class="chart-title">Today's Sales Forecast</div>
                            <div class="chart">
                                <div class="bar" style="height: 60%" data-value="45%">
                                    <div class="bar-label">Morning</div>
                                </div>
                                <div class="bar" style="height: 80%" data-value="35%">
                                    <div class="bar-label">Lunch</div>
                                </div>
                                <div class="bar" style="height: 40%" data-value="20%">
                                    <div class="bar-label">Evening</div>
                                </div>
                            </div>
                        </div>

                        <div style="padding: 12px; background: var(--grab-green-light); border-radius: 12px; margin-top: 10px;">
                                <p style="margin-bottom: 10px; color: var(--grab-green-dark);">
                                    This forecast is based on:
                                </p>
                                <p style="color: var(--soft-black);">
<ul>
                                    <li>Last week's performance</li>
                                    <li>Historical Tuesday data</li>
                                    <li>Current market trends</li>
                                    <li>Weather conditions</li>
                        </ul>                                </p>
                            </div>

                    `;
                    
  
                    
                    addMessage(metricsHtml);

                    const forecastStrategies = `
                        <div>
                            <p> Recommended Business Strategies:</p>
                            
                            <div style="margin-bottom: 15px;">
                                <p style="font-weight: 500; color: var(--grab-green-dark); margin-bottom: 8px;">
                                    <i class="fas fa-clock" style="margin-right: 8px;"></i>
                                    Morning Rush (6-11 AM):
                                </p>
                                <ul style="list-style-type: none; padding-left: 24px;">
                                    <li style="margin-bottom: 6px; position: relative;">
                                        <span style="position: absolute; left: -20px;"></span>
Prepare extra batches of Roti Canai Special                                    </li>
                                    <li style="margin-bottom: 6px; position: relative;">
                                        <span style="position: absolute; left: -20px;"></span>
                                        Recommended: Add more staff during these periods
                                    </li>
                                    <li style="position: relative;">
                                        <span style="position: absolute; left: -20px;"></span>
                                        Average customer wait time: 8 minutes
                                    </li>
                                </ul>
                            </div>

                            <div style="margin-bottom: 15px;">
                                <p style="font-weight: 500; color: var(--grab-green-dark); margin-bottom: 8px;">
                                    <i class="fas fa-utensils" style="margin-right: 8px;"></i>
                                    Menu Performance:
                                </p>
                                <ul style="list-style-type: none; padding-left: 24px;">
                                    <li style="margin-bottom: 6px; position: relative;">
                                        <span style="position: absolute; left: -20px;"></span>
                                        Introduce "Lunch Special" combo
                                    <li style="margin-bottom: 6px; position: relative;">
                                        <span style="position: absolute; left: -20px;"></span>
                                        Pre-prepare popular items
                                    </li>
                                </ul>
                            </div>

                        </div>
                    `;

                    
                    addMessage(' Recommended Business Strategies:\n\n' +
                        '1. Morning Rush (6-11 AM):\n' +
                        '    Prepare extra batches of Roti Canai Special\n' +
                        '    Set up quick-service stations for faster turnover\n' +
                        '    Focus on combo deals for office workers\n\n' +
                        '2. Lunch Peak (11 AM-2 PM):\n' +
                        '    Introduce "Lunch Special" combo\n' +
                        '    Pre-prepare popular items\n' +
                        '    Optimize kitchen workflow for bulk orders\n\n' +
                        '3. Evening (2-10 PM):\n' +
                        '    Focus on family-sized portions\n' +
                        '    Promote dessert items\n' +
                        '    Maintain fresh preparation for quality');


            

            addMessage('Here\'s your weekly business report:', false);
            showWeeklyBusinessReport();
            
            
        }

        function handleInsightsResponse(message) {
            const lowerMessage = message.toLowerCase();
            
            // Show typing indicator
            showTypingIndicator();
            
            setTimeout(() => {
                // Hide typing indicator
                hideTypingIndicator();
                
                if (lowerMessage.includes('month') || lowerMessage.includes('performance') || lowerMessage.includes('business')) {
                    addMessage('I can help you analyze your business performance. Would you like to see this month\'s overview, weekly trends, or compare with previous periods?', false);
                } else if (lowerMessage.includes('weekly') || lowerMessage.includes('week') || lowerMessage.includes('report')) {
                    showWeeklyBusinessReport();
                } else if (lowerMessage.includes('top selling') || lowerMessage.includes('items')) {
                    // Add response for top selling items
                    const topSellingHtml = `
                        <div>
                            <p>Here are the details about your top selling items:</p>
                            
                            <div class="charts-container">
                                <div style="font-size: 14px; color: var(--secondary-text); margin-bottom: 10px;">Top Selling Items</div>
                                <div class="revenue-chart">
                                    <div class="revenue-bar" style="height: 90%" data-value="35%">
                                        <div class="revenue-label">Roti Canai Special</div>
                                    </div>
                                    <div class="revenue-bar" style="height: 75%" data-value="25%">
                                        <div class="revenue-label">Nasi Lemak</div>
                                    </div>
                                    <div class="revenue-bar" style="height: 60%" data-value="20%">
                                        <div class="revenue-label">Teh Tarik</div>
                                    </div>
                                    <div class="revenue-bar" style="height: 45%" data-value="15%">
                                        <div class="revenue-label">Milo Ais</div>
                                    </div>
     
                                </div>
                            </div>
                            
                            <div style="margin-top: 15px;">
                                <p><strong>Roti Canai Special</strong></p>
                                <ul>
                                    <li>Average daily orders: 45-50</li>
                                    <li>Peak hours: 7-9 AM, 12-2 PM</li>
                                    <li>Customer rating: 4.8/5</li>
                                </ul>
                                
                                <p><strong>Nasi Lemak</strong></p>
                                <ul>
                                    <li>Average daily orders: 35-40</li>
                                    <li>Peak hours: 8-10 AM</li>
                                    <li>Customer rating: 4.6/5</li>
                                </ul>
                            </div>
                        </div>
                    `;
                    addMessage(topSellingHtml);
                } else if (lowerMessage.includes('run out of eggs') || lowerMessage.includes('egg shortage')) {
                    // Add response for egg shortage
                    const eggShortageHtml = `
                        <div>
                            <p>I can help you manage the egg shortage situation. Here's what we can do:</p>
                            
                            <div style="background-color: var(--grab-green-light); border-radius: 12px; padding: 15px; margin: 15px 0;">
                                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                                    <i class="fas fa-exclamation-triangle" style="color: var(--grab-green);"></i>
                                    <strong>Action Plan:</strong>
                                </div>
                                <ul style="margin-left: 25px;">
                                    <li>Stop accepting orders for egg-containing items</li>
                                    <li>Place an urgent order for eggs</li>
                                    <li>Offer alternatives to customers</li>
                                    <li>Update the menu board</li>
                                </ul>
                            </div>
                            
                            <p>Would you like me to disable the egg-containing items from your menu?</p>
                            <div class="button-container row">
                                <button onclick="disableEggItems('yes')" class="action-button">
                                    <i class="fas fa-check"></i> Yes, Disable Items
                                </button>
                                <button onclick="disableEggItems('no')" class="action-button secondary">
                                    <i class="fas fa-times"></i> No, I'll Handle It
                                </button>
                            </div>
                        </div>
                    `;
                    addMessage(eggShortageHtml);
                } else if (lowerMessage.includes('business overview')) {
                    // Add the initial business overview message
                    addMessage(message, false);
                    
                    // Add the graph visualization after a short delay
                    setTimeout(() => {
                        const graphData = [
                            { label: 'Mon', value: 85 },
                            { label: 'Tue', value: 92 },
                            { label: 'Wed', value: 78 },
                            { label: 'Thu', value: 95 },
                            { label: 'Fri', value: 88 }
                        ];
                        
                        const graphHtml = `
                            <div class="graph-container">
                                ${graphData.map((item, index) => `
                                    <div class="graph-bar" style="left: ${index * 40 + 15}px; height: ${item.value}px;">
                                        <div class="graph-value">${item.value}%</div>
                                        <div class="graph-label">${item.label}</div>
                                    </div>
                                `).join('')}
                            </div>
                            <p style="margin-top: 30px; text-align: center; color: var(--secondary-text);">Weekly Performance Overview</p>
                        `;
                        
                        addMessage(graphHtml, false);
                    }, 1000);
                } else if (lowerMessage.includes('improve weekend sales') || lowerMessage.includes('weekend sales') || lowerMessage.includes('boost weekend')) {
                    // Response for improving weekend sales
                    const weekendSalesAdviceHtml = `
                        <div>
                            <p style="color: var(--grab-green-dark); font-weight: 500; margin-bottom: 12px;">
                                Personalized Business Advice:
                            </p>

                            <div style="padding: 12px; background: var(--grab-green-light); border-radius: 12px; margin-bottom: 15px;">
                                <p style="margin-bottom: 10px; color: var(--grab-green-dark);">
                                    <i class="fas fa-lightbulb" style="margin-right: 8px;"></i>
                                    Local Market Insight
                                </p>
                                <p style="color: var(--soft-black);">
                                    Since you're a small caf in Kedah, consider bundling Roti Jala & Teh Tarik  last week, similar outlets saw 18% spike with this offer.
                                </p>
                            </div>

                            <div style="margin-bottom: 15px;">
                                <p style="font-weight: 500; color: var(--grab-green-dark); margin-bottom: 8px;">
                                    <i class="fas fa-clock" style="margin-right: 8px;"></i>
                                    Peak Hours Analysis:
                                </p>
                                <ul style="list-style-type: none; padding-left: 24px;">
                                    <li style="margin-bottom: 6px; position: relative;">
                                        <span style="position: absolute; left: -20px;"></span>
                                        Busiest hours: 7-9 AM and 12-2 PM
                                    </li>
                                    <li style="margin-bottom: 6px; position: relative;">
                                        <span style="position: absolute; left: -20px;"></span>
                                        Recommended: Add more staff during these periods
                                    </li>
                                    <li style="position: relative;">
                                        <span style="position: absolute; left: -20px;"></span>
                                        Average customer wait time: 8 minutes
                                    </li>
                                </ul>
                            </div>

                            <div style="margin-bottom: 15px;">
                                <p style="font-weight: 500; color: var(--grab-green-dark); margin-bottom: 8px;">
                                    <i class="fas fa-utensils" style="margin-right: 8px;"></i>
                                    Menu Performance:
                                </p>
                                <ul style="list-style-type: none; padding-left: 24px;">
                                    <li style="margin-bottom: 6px; position: relative;">
                                        <span style="position: absolute; left: -20px;"></span>
                                        Roti Canai Special: 50% of total revenue
                                    </li>
                                    <li style="margin-bottom: 6px; position: relative;">
                                        <span style="position: absolute; left: -20px;"></span>
                                        Suggested: Create combo deals with top sellers
                                    </li>
                                    <li style="position: relative;">
                                        <span style="position: absolute; left: -20px;"></span>
                                        Customer favorite add-ons: Extra cheese, special sauce
                                    </li>
                                </ul>
                            </div>

                            <div>
                                <p style="font-weight: 500; color: var(--grab-green-dark); margin-bottom: 8px;">
                                    <i class="fas fa-chart-line" style="margin-right: 8px;"></i>
                                    Growth Opportunities:
                                </p>
                                <ul style="list-style-type: none; padding-left: 24px;">
                                    <li style="margin-bottom: 6px; position: relative;">
                                        <span style="position: absolute; left: -20px;"></span>
                                        Evening sales are lower than morning/afternoon
                                    </li>
                                    <li style="margin-bottom: 6px; position: relative;">
                                        <span style="position: absolute; left: -20px;"></span>
                                        Opportunity: Run promotions during off-peak hours
                                    </li>
                                    <li style="position: relative;">
                                        <span style="position: absolute; left: -20px;"></span>
                                        Consider: Evening special menu or family packages
                                    </li>
                                </ul>
                            </div>
                        </div>
                    `;
                    addMessage(weekendSalesAdviceHtml);
                } else {
                    // Generic response for other queries
                    if (currentLanguage === 'Bahasa Melayu') {
                        addMessage('Saya faham anda bertanya tentang "' + message + '". Saya boleh membantu anda dengan itu. Bolehkah anda memberikan lebih banyak butiran tentang apa yang anda ingin tahu atau lakukan?', false);
                    } else {
                        addMessage('I understand you\'re asking about "' + message + '". I can help you with that. Could you provide more details about what you\'d like to know or do?', false);
                    }
                }
            }, 1500);
        }

        // Promotions Chat
        function showPromotionsChat() {
            currentChat = 'promotions';
            showChat('Promotions');

            const analysisHtml2 = `
                <div>
                    <p style="color: var(--grab-green-dark); font-weight: 500; margin-bottom: 12px;">
                        Menu Performance Analysis
                    </p>

                    <div style="background: var(--grab-green-light); padding: 15px; border-radius: 12px; margin-top: 15px;">
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                            <i class="fas fa-chart-line" style="color: var(--grab-green);"></i>
                            <span style="color: var(--grab-green-dark); font-weight: 500;">Performance Alert</span>
                        </div>
                        <p style="margin: 0; color: var(--soft-black);">Your Roti Canai Special is really a blast in the market right now! Would you like to boost promotion for this item or dismiss this suggestion?</p>
                    </div>

                    <div style="display: flex; gap: 10px; margin-top: 15px;">
                        <button onclick="handlePromotionDecision('promote')" class="action-button">
                            <i class="fas fa-bullhorn"></i> Promote
                        </button>
                        <button onclick="handlePromotionDecision('dismiss')" class="action-button secondary">
                            <i class="fas fa-times"></i> Dismiss
                        </button>
                    </div>
                </div>
            `;

            addMessage(analysisHtml2);
            
            // Initial performance analysis
            const analysisHtml = `
                <div>
                    <p style="color: var(--grab-green-dark); font-weight: 500; margin-bottom: 12px;">
                        Menu Performance Analysis
                    </p>

                    <div style="background: var(--grab-green-light); padding: 15px; border-radius: 12px; margin-top: 15px;">
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                            <i class="fas fa-chart-line" style="color: var(--grab-green);"></i>
                            <span style="color: var(--grab-green-dark); font-weight: 500;">Performance Alert</span>
                        </div>
                        <p style="margin: 0; color: var(--soft-black);">Roti Jala isn't doing well compared to other menu items. Would you like to promote this item or dismiss this suggestion?</p>
                    </div>

                    <div style="display: flex; gap: 10px; margin-top: 15px;">
                        <button onclick="handlePromotionDecision('promote')" class="action-button">
                            <i class="fas fa-bullhorn"></i> Promote
                        </button>
                        <button onclick="handlePromotionDecision('dismiss')" class="action-button secondary">
                            <i class="fas fa-times"></i> Dismiss
                        </button>
                    </div>
                </div>
            `;
            addMessage(analysisHtml);
        }

        function handlePromotionDecision(decision) {
            if (decision === 'promote' || lowerMessage.includes('promote')) {
                addMessage('Let\'s promote Roti Jala', true);
                
                // Show promotion setup form
                const setupHtml = `
                    <div>
                        <p>Great choice. How many target audience do you want to reach and for how many days?</p>
                        <p>As of today, the current rate for promotion is <strong>RM5 per day per 100 customers</strong>.</p>
                        
                        <div style="background-color: var(--grab-green-light); border-radius: 12px; padding: 15px; margin-top: 12px;">
                                <div style="display: flex; align-items: center; margin-bottom: 10px;">
                                    <div style="width: 30px; height: 30px; border-radius: 50%; background-color: var(--grab-green); display: flex; align-items: center; justify-content: center; margin-right: 10px;">
                                        <i class="fas fa-user " style="color: white; font-size: 14px;"></i>
                                    </div>
                                    <div style="font-weight: 600; color: var(--grab-green-dark);">Total Target Audience</div>
                                </div>
                                <div style="display: flex; align-items: center; margin-bottom: 10px;">
                                    <div style="width: 30px; height: 30px; border-radius: 50%; background-color: var(--grab-green); display: flex; align-items: center; justify-content: center; margin-right: 10px;">
                                        <i class="fas fa-clock" style="color: white; font-size: 14px;"></i>
                                    </div>
                                    <div style="font-weight: 600; color: var(--grab-green-dark);">Days</div>
                                </div>
                            </div>
                `;
                addMessage(setupHtml);
            } else {
                addMessage('I\'ll dismiss this suggestion', true);
                addMessage('No problem! I\'ll notify you when there are other promotion opportunities.', false);
            }
        }

        function updatePromotionPrice() {
            const duration = document.getElementById('promotion-duration').value;
            const totalPrice = duration * 5;
            document.getElementById('total-price').textContent = `RM${totalPrice}`;
        }

        function showPromotionConfirmation() {
            const duration = document.getElementById('promotion-duration').value;
            const audience = document.getElementById('target-audience').value;
            const totalPrice = duration * 5;

            const confirmationHtml = `
                <div>
                    <div style="background: var(--grab-green-light); padding: 15px; border-radius: 12px; margin-bottom: 15px;">
                        <p style="margin: 0 0 10px 0; font-weight: 500; color: var(--grab-green-dark);">Promotion Summary:</p>
                        <ul style="margin: 0; padding-left: 20px; color: var(--soft-black);">
                            <li>Target: ${audience.replace(/^\w/, c => c.toUpperCase())} Customers</li>
                            <li>Duration: ${duration} days</li>
                            <li>Total Price: RM${totalPrice}</li>
                        </ul>
                    </div>
                    <p>Are you sure you want to proceed with this promotion?</p>
                    <div style="display: flex; gap: 10px;">
                        <button onclick="confirmPromotion()" class="action-button">
                            <i class="fas fa-check"></i> Yes, Confirm
                        </button>
                        <button onclick="cancelPromotion()" class="action-button secondary">
                            <i class="fas fa-times"></i> Cancel
                        </button>
                    </div>
                </div>
            `;
            addMessage(confirmationHtml);
        }

        function confirmPromotion() {
            
            const successHtml = `
                <div>
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                        <div style="width: 40px; height: 40px; border-radius: 50%; background-color: var(--grab-green-light); display: flex; align-items: center; justify-content: center;">
                            <i class="fas fa-check" style="color: var(--grab-green); font-size: 20px;"></i>
                        </div>
                        <div>
                            <div style="font-weight: 600; color: var(--grab-green-dark);">Promotion Activated!</div>
                            <div style="font-size: 14px; color: var(--secondary-text);">Your Roti Jala will now reach 200 Customers for the next 5 days days.</div>
                        </div>
                    </div>
                    <div style="background: var(--grab-green-light); padding: 12px; border-radius: 8px;">
                        <p style="margin: 0; color: var(--grab-green-dark); font-size: 14px;">
                            <i class="fas fa-info-circle"></i> You can view or stop the ad anytime from the Promotions dashboard.
                        </p>
                    </div>
                </div>
            `;
            addMessage(successHtml);
        }

        function cancelPromotion() {
            addMessage('I want to cancel this promotion', true);
            addMessage('No problem! Let me know if you want to try a different promotion strategy.', false);
        }

        // AI Chat
        function showAIChat() {
            currentChat = 'ai';
            showChat('Chat with AI');
            
            // Clear existing messages
            chatMessages.innerHTML = '';
            
            // Always show initial welcome message based on selected language
            const currentLanguage = localStorage.getItem('selectedLanguage') || 'English';
            let welcomeMessage = '';
            
            if (currentLanguage === 'Bahasa Melayu') {
                // Set welcome message in Malay
                welcomeMessage = 'Hai Anas!  Bersedia untuk memeriksa Roti Canai King? Apa yang boleh saya bantu hari ini?';
            } else {
                // Set welcome message in English
                welcomeMessage = 'Hi Anas!  Ready to check on Roti Canai King? What can I help you with today?';
            }
            
            // Display welcome message (without adding to history)
            const welcomeDiv = document.createElement('div');
            welcomeDiv.className = 'message';
            
            const welcomeBubble = document.createElement('div');
            welcomeBubble.className = 'bubble';
            welcomeBubble.textContent = welcomeMessage;
            
            // Get current time for timestamp
            const now = new Date();
            const timeString = now.toLocaleTimeString('en-US', { 
                hour: 'numeric', 
                minute: '2-digit',
                hour12: true 
            });
            
            // Add timestamp
            const timestampDiv = document.createElement('div');
            timestampDiv.className = 'timestamp';
            timestampDiv.textContent = timeString;
            welcomeBubble.appendChild(timestampDiv);
            
            welcomeDiv.appendChild(welcomeBubble);
            chatMessages.appendChild(welcomeDiv);
            
            // Load and display saved history after the welcome message
            if (chatHistory.ai && chatHistory.ai.length > 0) {
                // Display all saved messages
                chatHistory.ai.forEach(msg => {
                    const messageDiv = document.createElement('div');
                    messageDiv.className = `message ${msg.isUser ? 'user' : 'ai'}`;
                    
                    const bubbleDiv = document.createElement('div');
                    bubbleDiv.className = 'bubble';
                    
                    if (msg.text.includes('<div') || msg.text.includes('<span') || msg.text.includes('<button')) {
                        bubbleDiv.innerHTML = msg.text;
                    } else {
                        bubbleDiv.textContent = msg.text;
                    }
                    
                    // Add timestamp
                    const timestampDiv = document.createElement('div');
                    timestampDiv.className = 'timestamp';
                    timestampDiv.textContent = msg.timestamp;
                    bubbleDiv.appendChild(timestampDiv);
                    
                    messageDiv.appendChild(bubbleDiv);
                    chatMessages.appendChild(messageDiv);
                });
                
                // Set conversation step based on last message
                const lastMessage = chatHistory.ai[chatHistory.ai.length - 1].text.toLowerCase();
                if (lastMessage.includes('yes') && lastMessage.includes('add')) {
                    conversationStep = 3;
                } else if (lastMessage.includes('roti canai cheese deluxe')) {
                    conversationStep = 2;
                } else if (lastMessage.includes('add') && (lastMessage.includes('menu') || lastMessage.includes('item'))) {
                    conversationStep = 1;
                }
            }
        }
        
        function handleAIResponse(message) {
            const lowerMessage = message.toLowerCase();
            const currentLanguage = localStorage.getItem('selectedLanguage') || 'English';
            
            // Show typing indicator
            showTypingIndicator();
            
            setTimeout(() => {
                // Hide typing indicator
                hideTypingIndicator();

                // Check if it's a Kedahan slang question about weekly performance
                if (lowerMessage.includes('hari ni business macam mana') || lowerMessage.includes('hari ni camne') || lowerMessage.includes('hari ni cemana')) {
                    showWeeklyBusinessReportinKedah();
                    return;
                }

                if(lowerMessage.includes('tak faham la') || lowerMessage.includes('panjangnya') || lowerMessage.includes('bahasa alien') || lowerMessage.includes('loghat kedah')){
                    const kedahanResponseHtml = `
                        <div style="font-family: var(--system-font);">
                            <p style="margin-bottom: 10px;">Mintak maaf, Anas. Hari ini perniagaan sangat terbaik. Ini apa yang kamu perolehi:</p>
                            
                            <div style="background: var(--grab-green-light); padding: 12px; border-radius: 8px; margin: 10px 0;">
                                <p style="margin-bottom: 8px; color: var(--grab-green-dark);">
                                    <i class="fas fa-arrow-up" style="margin-right: 6px;"></i>
                                    Jualan naik 15% dari minggu lepas
                                </p>
                                <p style="margin-bottom: 8px; color: var(--grab-green-dark);">
                                    <i class="fas fa-star" style="margin-right: 6px;"></i>
                                    Roti Canai Special laku gila, 50 keping sejam!
                                </p>
                                <p style="color: var(--grab-green-dark);">
                                    <i class="fas fa-clock" style="margin-right: 6px;"></i>
                                    Ramai orang datang waktu pagi, 7-9 pagi sangat penuh
                                </p>
                            </div>
                            
                            <p style="margin-top: 10px;">Cadangan saya adalah untuk mengenalkan menu combo "Teh Tarik + Roti Canai Special" kepada pelanggan. Ini adalah pilihan yang menarik kerana ia memberikan kepuasan makan yang lebih besar dan harga yang lebih murah.</p>
                        </div>
                    `;
                    addMessage(kedahanResponseHtml);
                    return;
                }


                if (lowerMessage.includes('terbaikla')  || lowerMessage.includes('mantap')){
                    addMessage("Terima Kasih, bos! Lepas ni saya akan cuba yang terbaik lagi")
                    return;
                }

                // Check for menu addition request
                if (lowerMessage.includes('add') && (lowerMessage.includes('menu') || lowerMessage.includes('item'))) {
                    if (currentLanguage === 'Bahasa Melayu') {
                        // Ask for menu item details in Bahasa Melayu
                        const requestHtml = `
                            <div style="margin-bottom: 15px;">
                                <p>Saya boleh membantu anda menambah item menu baharu ke Roti Canai King. Sila berikan butiran berikut:</p>
                                <div style="background-color: var(--grab-green-light); border-radius: 12px; padding: 15px; margin-top: 12px;">
                                    <div style="display: flex; align-items: center; margin-bottom: 10px;">
                                        <div style="width: 30px; height: 30px; border-radius: 50%; background-color: var(--grab-green); display: flex; align-items: center; justify-content: center; margin-right: 10px;">
                                            <i class="fas fa-utensils" style="color: white; font-size: 14px;"></i>
                                        </div>
                                        <div style="font-weight: 600; color: var(--grab-green-dark);">Nama item</div>
                                    </div>
                                    <div style="display: flex; align-items: center; margin-bottom: 10px;">
                                        <div style="width: 30px; height: 30px; border-radius: 50%; background-color: var(--grab-green); display: flex; align-items: center; justify-content: center; margin-right: 10px;">
                                            <i class="fas fa-tag" style="color: white; font-size: 14px;"></i>
                                        </div>
                                        <div style="font-weight: 600; color: var(--grab-green-dark);">Harga (dalam RM)</div>
                                    </div>
                                    <div style="display: flex; align-items: center;">
                                        <div style="width: 30px; height: 30px; border-radius: 50%; background-color: var(--grab-green); display: flex; align-items: center; justify-content: center; margin-right: 10px;">
                                            <i class="fas fa-layer-group" style="color: white; font-size: 14px;"></i>
                                        </div>
                                        <div style="font-weight: 600; color: var(--grab-green-dark);">Kategori</div>
                                    </div>
                                </div>
                                <p style="margin-top: 12px; font-size: 14px; color: var(--secondary-text);">Anda boleh memberikan butiran ini dalam format yang anda suka.</p>
                            </div>
                        `;
                        addMessage(requestHtml);
                    } else {
                        // Original English version
                        const requestHtml = `
                            <div style="margin-bottom: 15px;">
                                <p>I can help you add a new menu item to Roti Canai King. Please provide the following details:</p>
                                <div style="background-color: var(--grab-green-light); border-radius: 12px; padding: 15px; margin-top: 12px;">
                                    <div style="display: flex; align-items: center; margin-bottom: 10px;">
                                        <div style="width: 30px; height: 30px; border-radius: 50%; background-color: var(--grab-green); display: flex; align-items: center; justify-content: center; margin-right: 10px;">
                                            <i class="fas fa-utensils" style="color: white; font-size: 14px;"></i>
                                        </div>
                                        <div style="font-weight: 600; color: var(--grab-green-dark);">Name of the item</div>
                                    </div>
                                    <div style="display: flex; align-items: center; margin-bottom: 10px;">
                                        <div style="width: 30px; height: 30px; border-radius: 50%; background-color: var(--grab-green); display: flex; align-items: center; justify-content: center; margin-right: 10px;">
                                            <i class="fas fa-tag" style="color: white; font-size: 14px;"></i>
                                        </div>
                                        <div style="font-weight: 600; color: var(--grab-green-dark);">Price (in RM)</div>
                                    </div>
                                    <div style="display: flex; align-items: center;">
                                        <div style="width: 30px; height: 30px; border-radius: 50%; background-color: var(--grab-green); display: flex; align-items: center; justify-content: center; margin-right: 10px;">
                                            <i class="fas fa-layer-group" style="color: white; font-size: 14px;"></i>
                                        </div>
                                        <div style="font-weight: 600; color: var(--grab-green-dark);">Category</div>
                                    </div>
                                </div>
                                <p style="margin-top: 12px; font-size: 14px; color: var(--secondary-text);">You can provide these details in any format you prefer.</p>
                            </div>
                        `;
                        addMessage(requestHtml);
                    }
                } else if (lowerMessage.includes('roti canai cheese deluxe') || 
                          (lowerMessage.includes('roti') && lowerMessage.includes('cheese') && lowerMessage.includes('4.90'))) {
                    if (currentLanguage === 'Bahasa Melayu') {
                        // Create a menu card with better styling in Bahasa Melayu
                        const menuCardHtml = `
                            <div style="background-color: var(--grab-green-light); border-radius: 12px; padding: 15px; margin-top: 12px;">
                                <div style="display: flex; align-items: center; margin-bottom: 10px;">
                                    <div style="width: 30px; height: 30px; border-radius: 50%; background-color: var(--grab-green); display: flex; align-items: center; justify-content: center; margin-right: 10px;">
                                        <i class="fas fa-utensils" style="color: white; font-size: 14px;"></i>
                                    </div>
                                    <div style="font-weight: 600; color: var(--grab-green-dark);">Roti Canai Cheese Deluxe</div>
                                </div>
                                <div style="display: flex; align-items: center; margin-bottom: 10px;">
                                    <div style="width: 30px; height: 30px; border-radius: 50%; background-color: var(--grab-green); display: flex; align-items: center; justify-content: center; margin-right: 10px;">
                                        <i class="fas fa-tag" style="color: white; font-size: 14px;"></i>
                                    </div>
                                    <div style="font-weight: 600; color: var(--grab-green-dark);">RM 4.90</div>
                                </div>
                                <div style="display: flex; align-items: center;">
                                    <div style="width: 30px; height: 30px; border-radius: 50%; background-color: var(--grab-green); display: flex; align-items: center; justify-content: center; margin-right: 10px;">
                                        <i class="fas fa-layer-group" style="color: white; font-size: 14px;"></i>
                                    </div>
                                    <div style="font-weight: 600; color: var(--grab-green-dark);">Item Istimewa</div>
                                </div>
                            </div>
                        `;
                        
                        // Combine the menu card and buttons in a single message
                        const combinedHtml = `
                            <div>
                                <p>Saya telah menyediakan pratonton item menu baharu anda berdasarkan butiran yang anda berikan:</p>
                                ${menuCardHtml}
                                <p>Adakah anda mahu meneruskan penambahan item menu ini?</p>
                                <div class="button-container row">
                                    <button onclick="confirmMenuAddition('yes')" class="action-button">
                                        <i class="fas fa-check"></i> Ya, Tambah
                                    </button>
                                    <button onclick="confirmMenuAddition('no')" class="action-button secondary">
                                        <i class="fas fa-times"></i> Tidak, Ubah
                                    </button>
                                </div>
                            </div>
                        `;
                        
                        addMessage(combinedHtml);
                    } else {
                        // Original English version
                        const menuCardHtml = `
                            <div style="background-color: var(--grab-green-light); border-radius: 12px; padding: 15px; margin-top: 12px;">
                                <div style="display: flex; align-items: center; margin-bottom: 10px;">
                                    <div style="width: 30px; height: 30px; border-radius: 50%; background-color: var(--grab-green); display: flex; align-items: center; justify-content: center; margin-right: 10px;">
                                        <i class="fas fa-utensils" style="color: white; font-size: 14px;"></i>
                                    </div>
                                    <div style="font-weight: 600; color: var(--grab-green-dark);">Roti Canai Cheese Deluxe</div>
                                </div>
                                <div style="display: flex; align-items: center; margin-bottom: 10px;">
                                    <div style="width: 30px; height: 30px; border-radius: 50%; background-color: var(--grab-green); display: flex; align-items: center; justify-content: center; margin-right: 10px;">
                                        <i class="fas fa-tag" style="color: white; font-size: 14px;"></i>
                                    </div>
                                    <div style="font-weight: 600; color: var(--grab-green-dark);">RM 4.90</div>
                                </div>
                                <div style="display: flex; align-items: center;">
                                    <div style="width: 30px; height: 30px; border-radius: 50%; background-color: var(--grab-green); display: flex; align-items: center; justify-content: center; margin-right: 10px;">
                                        <i class="fas fa-layer-group" style="color: white; font-size: 14px;"></i>
                                    </div>
                                    <div style="font-weight: 600; color: var(--grab-green-dark);">Signature Items</div>
                                </div>
                            </div>
                        `;
                        
                        // Combine the menu card and buttons in a single message
                        const combinedHtml = `
                            <div>
                                <p>I've prepared a preview of your new menu item based on the details you provided:</p>
                                ${menuCardHtml}
                                <p>Would you like to proceed with adding this menu item?</p>
                                <div class="button-container row">
                                    <button onclick="confirmMenuAddition('yes')" class="action-button">
                                        <i class="fas fa-check"></i> Yes, Add It
                                    </button>
                                    <button onclick="confirmMenuAddition('no')" class="action-button secondary">
                                        <i class="fas fa-times"></i> No, Change
                                    </button>
                                </div>
                            </div>
                        `;
                        
                        addMessage(combinedHtml);
                    }
                } else if (lowerMessage.includes('yes') && lowerMessage.includes('add')) {
                    showMenuAdditionSuccess();
                } else if (lowerMessage.includes('no') && lowerMessage.includes('change')) {
                    if (currentLanguage === 'Bahasa Melayu') {
                        addMessage('Tiada masalah! Apa yang anda mahu ubah tentang item menu tersebut?', false);
                    } else {
                        addMessage('No problem! What would you like to change about the menu item?', false);
                    }
                } else if (lowerMessage.includes('month') && (lowerMessage.includes('performance') || lowerMessage.includes('business'))) {
                    showBusinessPerformance();
                } else if (lowerMessage.includes('top selling') || lowerMessage.includes('items')) {
                    // Add response for top selling items
                    const topSellingHtml = `
                        <div>
                            <p>Here are the details about your top selling items:</p>
                            
                            <div class="charts-container">
                                <div style="font-size: 14px; color: var(--secondary-text); margin-bottom: 10px;">Top Selling Items</div>
                                <div class="revenue-chart">
                                    <div class="revenue-bar" style="height: 90%" data-value="35%">
                                        <div class="revenue-label">Roti Canai Special</div>
                                    </div>
                                    <div class="revenue-bar" style="height: 75%" data-value="25%">
                                        <div class="revenue-label">Roti Canai Biasa</div>
                                    </div>
                                    <div class="revenue-bar" style="height: 60%" data-value="20%">
                                        <div class="revenue-label">Teh Tarik</div>
                                    </div>
                                    <div class="revenue-bar" style="height: 45%" data-value="15%">
                                        <div class="revenue-label">Roti Telur</div>
                                    </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div style="margin-top: 15px;">
                                <p><strong>Roti Canai Special</strong></p>
                                <ul>
                                    <li>Average daily orders: 45-50</li>
                                    <li>Peak hours: 7-9 AM, 12-2 PM</li>
                                    <li>Customer rating: 4.8/5</li>
                                </ul>
                                
                                <p><strong>Roti Canai Biasa</strong></p>
                                <ul>
                                    <li>Average daily orders: 35-36</li>
                                    <li>Peak hours: 8-10 AM</li>
                                    <li>Customer rating: 4.6/5</li>
                                </ul>
                                <p><strong>Teh Tarik</strong></p>
                                <ul>
                                    <li>Average daily orders: 20-21</li>
                                    <li>Peak hours: 7-9 AM</li>
                                    <li>Customer rating: 4.8/5</li>
                                </ul>
                                <p><strong>Roti Telur</strong></p>
                                <ul>
                                    <li>Average daily orders: 24-30</li>
                                    <li>Peak hours: 7-9 AM, 12-2 PM</li>
                                    <li>Customer rating: 4.8/5</li>
                                </ul>
                            </div>
                        </div>
                    `;
                    addMessage(topSellingHtml);
                } else if (lowerMessage.includes('run out of eggs') || lowerMessage.includes('egg shortage')) {
                    // Add response for egg shortage
                    const eggShortageHtml = `
                        <div>
                            <p>I can help you manage the egg shortage situation. Here's what we can do:</p>
                            
                            <div style="background-color: var(--grab-green-light); border-radius: 12px; padding: 15px; margin: 15px 0;">
                                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                                    <i class="fas fa-exclamation-triangle" style="color: var(--grab-green);"></i>
                                    <strong>Action Plan:</strong>
                                </div>
                                <ul style="margin-left: 25px;">
                                    <li>Stop accepting orders for egg-containing items</li>
                                    <li>Place an urgent order for eggs</li>
                                    <li>Offer alternatives to customers</li>
                                    <li>Update the menu board</li>
                                </ul>
                            </div>
                            
                            <p>Would you like me to disable the egg-containing items from your menu?</p>
                            <div class="button-container row">
                                <button onclick="disableEggItems('yes')" class="action-button">
                                    <i class="fas fa-check"></i> Confirm
                                </button>
                                <button onclick="disableEggItems('no')" class="action-button secondary">
                                    <i class="fas fa-times"></i> Cancel
                                </button>
                            </div>
                        </div>
                    `;
                    addMessage(eggShortageHtml);
                } else if (lowerMessage.includes('business overview')) {
                    // Add the initial business overview message
                    addMessage(message, false);
                    
                    // Add the graph visualization after a short delay
                    setTimeout(() => {
                        const graphData = [
                            { label: 'Mon', value: 85 },
                            { label: 'Tue', value: 92 },
                            { label: 'Wed', value: 78 },
                            { label: 'Thu', value: 95 },
                            { label: 'Fri', value: 88 }
                        ];
                        
                        const graphHtml = `
                            <div class="graph-container">
                                ${graphData.map((item, index) => `
                                    <div class="graph-bar" style="left: ${index * 40 + 15}px; height: ${item.value}px;">
                                        <div class="graph-value">${item.value}%</div>
                                        <div class="graph-label">${item.label}</div>
                                    </div>
                                `).join('')}
                            </div>
                            <p style="margin-top: 30px; text-align: center; color: var(--secondary-text);">Weekly Performance Overview</p>
                        `;
                        
                        addMessage(graphHtml, false);
                    }, 1000);
                } else if (lowerMessage.includes('improve weekend sales') || lowerMessage.includes('weekend sales') || lowerMessage.includes('boost weekend')) {
                    // Response for improving weekend sales
                    const weekendSalesAdviceHtml = `
                        <div>
                            <p style="color: var(--grab-green-dark); font-weight: 500; margin-bottom: 12px;">
                                Personalized  Business Analysis:
                            </p>

                            <div style="padding: 12px; background: var(--grab-green-light); border-radius: 12px; margin-bottom: 15px;">
                                <p style="margin-bottom: 10px; color: var(--grab-green-dark);">
                                    <i class="fas fa-lightbulb" style="margin-right: 8px;"></i>
                                    Local Market Insight
                                </p>
                                <p style="color: var(--soft-black);">
                                    Since you're a small caf in Kedah, consider bundling Roti Jala & Teh Tarik  last week, similar outlets saw 18% spike with this offer.
                                </p>
                            </div>

                            <div style="margin-bottom: 15px;">
                                <p style="font-weight: 500; color: var(--grab-green-dark); margin-bottom: 8px;">
                                    <i class="fas fa-clock" style="margin-right: 8px;"></i>
                                    Peak Hours Analysis:
                                </p>
                                <ul style="list-style-type: none; padding-left: 24px;">
                                    <li style="margin-bottom: 6px; position: relative;">
                                        <span style="position: absolute; left: -20px;"></span>
                                        Busiest hours: 7-9 AM and 12-2 PM
                                    </li>
                                    <li style="margin-bottom: 6px; position: relative;">
                                        <span style="position: absolute; left: -20px;"></span>
                                        Recommended: Add more staff during these periods
                                    </li>
                                    <li style="position: relative;">
                                        <span style="position: absolute; left: -20px;"></span>
                                        Average customer wait time: 8 minutes
                                    </li>
                                </ul>
                            </div>

                            <div style="margin-bottom: 15px;">
                                <p style="font-weight: 500; color: var(--grab-green-dark); margin-bottom: 8px;">
                                    <i class="fas fa-utensils" style="margin-right: 8px;"></i>
                                    Menu Performance:
                                </p>
                                <ul style="list-style-type: none; padding-left: 24px;">
                                    <li style="margin-bottom: 6px; position: relative;">
                                        <span style="position: absolute; left: -20px;"></span>
                                        Roti Canai Special: 50% of total revenue
                                    </li>
                                    <li style="margin-bottom: 6px; position: relative;">
                                        <span style="position: absolute; left: -20px;"></span>
                                        Suggested: Create combo deals with top sellers
                                    </li>
                                    <li style="position: relative;">
                                        <span style="position: absolute; left: -20px;"></span>
                                        Customer favorite add-ons: Extra cheese, special sauce
                                    </li>
                                </ul>
                            </div>

                            <div>
                                <p style="font-weight: 500; color: var(--grab-green-dark); margin-bottom: 8px;">
                                    <i class="fas fa-chart-line" style="margin-right: 8px;"></i>
                                    Growth Opportunities:
                                </p>
                                <ul style="list-style-type: none; padding-left: 24px;">
                                    <li style="margin-bottom: 6px; position: relative;">
                                        <span style="position: absolute; left: -20px;"></span>
                                        Evening sales are lower than morning/afternoon
                                    </li>
                                    <li style="margin-bottom: 6px; position: relative;">
                                        <span style="position: absolute; left: -20px;"></span>
                                        Opportunity: Run promotions during off-peak hours
                                    </li>
                                    <li style="position: relative;">
                                        <span style="position: absolute; left: -20px;"></span>
                                        Consider: Evening special menu or family packages
                                    </li>
                                </ul>
                            </div>
                        </div>
                    `;
                    addMessage(weekendSalesAdviceHtml);
                } else {
                    // Generic response for other queries
                    if (currentLanguage === 'Bahasa Melayu') {
                        addMessage('Saya faham anda bertanya tentang "' + message + '". Saya boleh membantu anda dengan itu. Bolehkah anda memberikan lebih banyak butiran tentang apa yang anda ingin tahu atau lakukan?', false);
                    } else {
                        addMessage('I understand you\'re asking about "' + message + '". I can help you with that. Could you provide more details about what you\'d like to know or do?', false);
                    }
                }
            }, 1500);
        }

        // Function to handle menu addition confirmation
        function confirmMenuAddition(response) {
            if (response === 'yes') {
                addMessage('Yes, please add it', true);
                
                // Show typing indicator
                showTypingIndicator();
                
                setTimeout(() => {
                    // Hide typing indicator
                    hideTypingIndicator();
                    
                    showMenuAdditionSuccess();
                }, 1500);
            } else {
                addMessage('No, I want to change something', true);
                
                // Show typing indicator
                showTypingIndicator();
                
                setTimeout(() => {
                    // Hide typing indicator
                    hideTypingIndicator();
                    addMessage('No problem! What would you like to change about the menu item?', false);
                }, 1500);
            }
        }

        // Function to show menu addition success message
        function showMenuAdditionSuccess() {
            // Success message with better styling
            const successHtml = `
                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                    <div style="width: 40px; height: 40px; border-radius: 50%; background-color: var(--grab-green-light); display: flex; align-items: center; justify-content: center;">
                        <i class="fas fa-check" style="color: var(--grab-green); font-size: 20px;"></i>
                    </div>
                    <div>
                        <div style="font-weight: 600; color: var(--grab-green-dark);">Menu Item Added Successfully!</div>
                        <div style="font-size: 14px; color: var(--secondary-text);">Roti Canai Cheese Deluxe has been added to your menu</div>
                    </div>
                </div>
                <div style="margin-top: 15px; padding: 12px; background-color: var(--light-gray-bg); border-radius: 10px; font-size: 14px;">
                    <div style="margin-bottom: 8px;"><strong>Notifications Sent:</strong></div>
                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 5px;">
                        <i class="fas fa-bell" style="color: var(--grab-green);"></i>
                        <span>Staff notification sent</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <i class="fas fa-envelope" style="color: var(--grab-green);"></i>
                        <span>Email confirmation sent to your registered email</span>
                    </div>
                </div>
                <div style="margin-top: 15px; font-size: 14px; color: var(--secondary-text);">
                    The new menu item will be available for ordering starting tomorrow.
                </div>
            `;
            addMessage(successHtml);
            
            // Add notification badge to the menu management chat item
            const menuChatItem = document.querySelector('.chat-item:nth-child(2)');
            if (menuChatItem) {
                const alertBadge = menuChatItem.querySelector('.alert-badge');
                if (alertBadge) {
                    alertBadge.textContent = '1';
            } else {
                    const newBadge = document.createElement('div');
                    newBadge.className = 'alert-badge';
                    newBadge.textContent = '1';
                    menuChatItem.querySelector('.chat-item-header').appendChild(newBadge);
                }
                
                // Update preview text
                const previewText = menuChatItem.querySelector('.chat-preview');
                if (previewText) {
                    previewText.textContent = 'New menu item added: Roti Canai Cheese Deluxe (RM 4.90)';
                }
            }
        }

        // Function to handle disabling egg items
        function disableEggItems(response) {
            if (response === 'yes') {
                addMessage('Yes, please disable those items', true);
                
                // Show typing indicator
                showTypingIndicator();
                
                setTimeout(() => {
                    // Hide typing indicator
                    hideTypingIndicator();
                    
                    // Success message with better styling
                    const successHtml = `
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                            <div style="width: 40px; height: 40px; border-radius: 50%; background-color: var(--grab-green-light); display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-check" style="color: var(--grab-green); font-size: 20px;"></i>
                            </div>
                            <div>
                                <div style="font-weight: 600; color: var(--grab-green-dark);">Items Disabled Successfully!</div>
                                <div style="font-size: 14px; color: var(--secondary-text);">Egg-containing items have been temporarily disabled</div>
                            </div>
                        </div>
                        <div style="margin-top: 15px; padding: 12px; background-color: var(--light-gray-bg); border-radius: 10px; font-size: 14px;">
                            <div style="margin-bottom: 8px;"><strong>Disabled Items:</strong></div>
                            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 5px;">
                                <i class="fas fa-ban" style="color: var(--red-action);"></i>
                                <span>Roti Canai with Egg</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 5px;">
                                <i class="fas fa-ban" style="color: var(--red-action);"></i>
                                <span>Nasi Lemak with Egg</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 5px;">
                                <i class="fas fa-ban" style="color: var(--red-action);"></i>
                                <span>Egg Omelette</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <i class="fas fa-ban" style="color: var(--red-action);"></i>
                                <span>Egg Salad</span>
                            </div>
                        </div>
                        <div style="margin-top: 15px; font-size: 14px; color: var(--secondary-text);">
                            These items will remain disabled until you re-enable them after receiving your egg supply.
                        </div>
                    `;
                    addMessage(successHtml);
                    
                    // Add notification badge to the inventory chat item
                    const inventoryChatItem = document.querySelector('.chat-item:nth-child(2)');
                    if (inventoryChatItem) {
                        const alertBadge = inventoryChatItem.querySelector('.alert-badge');
                        if (alertBadge) {
                            alertBadge.textContent = '1';
                        } else {
                            const newBadge = document.createElement('div');
                            newBadge.className = 'alert-badge';
                            newBadge.textContent = '1';
                            inventoryChatItem.querySelector('.chat-item-header').appendChild(newBadge);
                        }
                        
                        // Update preview text
                        const previewText = inventoryChatItem.querySelector('.chat-preview');
                        if (previewText) {
                            previewText.textContent = 'Egg shortage: 4 items temporarily disabled';
                        }
                    }
                    
                    // Set a timer to trigger the proactive reminder for tomato stock
                    setTimeout(() => {
                        showProactiveReminder();
                    }, 3000);
                    
                }, 1500);
            } else {
                addMessage('No, I\'ll handle it myself', true);
                
                // Show typing indicator
                showTypingIndicator();
                
                setTimeout(() => {
                    // Hide typing indicator
                    hideTypingIndicator();
                    addMessage('No problem! Let me know if you need any other assistance with your inventory or menu management.', false);
                    
                    // Set a timer to trigger the proactive reminder for tomato stock
                    setTimeout(() => {
                        showProactiveReminder();
                    }, 3000);
                }, 1500);
            }
        }

        // Function to show proactive reminder for low tomato stock
        function showProactiveReminder() {
            // Create notification element
            const notification = document.createElement('div');
            notification.className = 'proactive-notification';
            notification.style.position = 'fixed';
            notification.style.top = '20px';
            notification.style.left = '50%';
            notification.style.transform = 'translateX(-50%)';
            notification.style.backgroundColor = 'white';
            notification.style.borderRadius = '12px';
            notification.style.padding = '15px';
            notification.style.boxShadow = '0 4px 20px rgba(0, 0, 0, 0.15)';
            notification.style.zIndex = '1000';
            notification.style.width = '90%';
            notification.style.maxWidth = '350px';
            notification.style.animation = 'slideDown 0.5s ease-out forwards';
            
            // Add notification content
            notification.innerHTML = `

            
                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                    <div style="width: 40px; height: 40px; border-radius: 50%; background-color: var(--grab-green-light); display: flex; align-items: center; justify-content: center;">
                        <i class="fas fa-exclamation-triangle" style="color: var(--grab-green); font-size: 20px;"></i>
                    </div>
                    <div>
                        <div style="font-weight: 600; color: var(--grab-green-dark);">AI Stock & Menu</div>
                        <div style="font-size: 14px; color: var(--secondary-text);">Just now</div>
                    </div>
                </div>
                <div style="margin-top: 10px; font-size: 16px;">
                    Sale's are rising than never before. I have set you a remainder for it!
                </div>
                <div style="display: flex; gap: 10px; margin-top: 15px;">
                    <button onclick="handleReorder('yes')" style="flex: 1; padding: 10px; background-color: var(--grab-green); color: white; border: none; border-radius: 8px; font-weight: 500; cursor: pointer;">
                        Reorder now
                    </button>
                    <button onclick="removeNotification(this)" style="flex: 1; padding: 10px; background-color: var(--light-gray-bg); color: var(--secondary-text); border: none; border-radius: 8px; font-weight: 500; cursor: pointer;">
                        Dismiss
                    </button>
                </div>
            `;
            
            // Add notification to the body
            document.body.appendChild(notification);
            
            // Add animation keyframes
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideDown {
                    from { opacity: 0; transform: translate(-50%, -100%); }
                    to { opacity: 1; transform: translate(-50%, 0); }
                }
                
                @keyframes slideUp {
                    from { opacity: 1; transform: translate(-50%, 0); }
                    to { opacity: 0; transform: translate(-50%, -100%); }
                }
            `;
            document.head.appendChild(style);
        }
        
        // Function to handle reorder response
        function handleReorder(response) {
            // Remove the notification with animation
            const notification = document.querySelector('.proactive-notification');
            if (notification) {
                notification.style.animation = 'slideUp 0.5s ease-out forwards';
                setTimeout(() => {
                    notification.remove();
                }, 500);
            }
            
            if (response === 'yes') {
                // Show inventory chat with reorder option
                showInventoryChat();
                
                // Add a message about tomato reorder
                setTimeout(() => {
                    addMessage('I can help you reorder tomatoes. How many kg would you like to order?', false);
                }, 1000);
            } else {
                // Show all proactive AI chats
                showAllProactiveChats();
            }
        }
        
        // Function to show all proactive AI chats
        function showAllProactiveChats() {
            // Show the chat list
            chatList.style.display = 'block';
            chatMessages.style.display = 'none';
            inputArea.style.display = 'none';
            backButton.style.display = 'none';
            headerTitle.textContent = 'Grab Assistant AI';
            currentChat = null;
            chatMessages.innerHTML = '';
            
            // Update the chat items to show all available options
            const chatItems = document.querySelectorAll('.chat-item');
            
            // Update AI Chat
            if (chatItems[0]) {
                const previewText = chatItems[0].querySelector('.chat-preview');
                if (previewText) {
                    previewText.textContent = 'Ask me anything about your business or make custom requests';
                }
            }
            
            // Update Inventory Chat
            if (chatItems[1]) {
                const previewText = chatItems[1].querySelector('.chat-preview');
                if (previewText) {
                    previewText.textContent = 'Low stock warning: Flour (25kg remaining), Eggs (2 trays remaining), Tomatoes (1kg remaining)';
                }
                
                const alertBadge = chatItems[1].querySelector('.alert-badge');
                if (alertBadge) {
                    alertBadge.textContent = '1';
                } else {
                    const newBadge = document.createElement('div');
                    newBadge.className = 'alert-badge';
                    newBadge.textContent = '1';
                    chatItems[1].querySelector('.chat-item-header').appendChild(newBadge);
                }
                
                // Update Business Insights
                if (chatItems[2]) {
                    const previewText = chatItems[2].querySelector('.chat-preview');
                    if (previewText) {
                        previewText.textContent = 'Today\'s revenue is up 15% compared to last Tuesday. Peak hours expected between 7-9 AM.';
                    }
                }
                
                // Update Promotions
                if (chatItems[3]) {
                    const previewText = chatItems[3].querySelector('.chat-preview');
                    if (previewText) {
                        previewText.textContent = 'Suggested: Create a breakfast combo deal to boost morning sales';
                    }
                }
            }
        }

        // Function to switch between chart tabs
        function switchChart(tab, chartId) {
            // Remove active class from all tabs and contents
            document.querySelectorAll('.chart-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.chart-content').forEach(c => c.classList.remove('active'));
            
            // Add active class to clicked tab and corresponding content
            tab.classList.add('active');
            document.getElementById(chartId + '-chart').classList.add('active');
        }
        
        // Function to handle business performance visualization
        function showBusinessPerformance() {


            // Second response: Tabbed charts (after 1 second delay)
            setTimeout(() => {
                const chartHtml = `
                <div>
                    <p>Here's a simple overview of this month's business performance:</p>
                    
                    <div class="metrics-grid">
                        <div class="metric-card">
                            <div class="metric-title">Monthly Revenue</div>
                            <div class="metric-value">RM 68,450</div>
                            <div class="metric-change">
                                <i class="fas fa-arrow-up"></i>12% vs last month
                            </div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-title">Total Item Orders</div>
                            <div class="metric-value">4,280</div>
                            <div class="metric-change">
                                <i class="fas fa-arrow-up"></i>8% vs last month
                            </div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-title">Average Order Value</div>
                            <div class="metric-value">RM 16.00</div>
                            <div class="metric-change">
                                <i class="fas fa-arrow-up"></i>3% vs last month
                            </div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-title">Customer Satisfaction</div>
                            <div class="metric-value">4.7/5</div>
                            <div class="metric-change">
                                <i class="fas fa-arrow-up"></i>0.2 vs last month
                            </div>
                        </div>
                    </div>
                </div>

                <div class="report-tabs">
                        <div class="tab-header">
                            <button class="tab-button active" onclick="switchTab(event, 'daily-revenue')">
                                <i class="fas fa-chart-line"></i> Weekly Revenue
                            </button>
                            <button class="tab-button" onclick="switchTab(event, 'order-count')">
                                <i class="fas fa-shopping-cart"></i> Weekly Order
                            </button>
                            <button class="tab-button" onclick="switchTab(event, 'popular-items')">
                                <i class="fas fa-chart-pie"></i> Popular Items
                            </button>
                        </div>
                        
                        <div id="daily-revenue" class="tab-content active">
                            <div class="chart-container">
                                <div class="chart-bar" style="height: 60%;">
                                    <div class="chart-value">RM6,105</div>
                                    <div class="chart-label">Week 1</div>
                                </div>
                                <div class="chart-bar" style="height: 100%;">
                                    <div class="chart-value">RM14,264</div>
                                    <div class="chart-label">Week 2</div>
                                </div>
                                <div class="chart-bar" style="height: 65%;">
                                    <div class="chart-value">RM8,845</div>
                                    <div class="chart-label">Week 3</div>
                                </div>
                                <div class="chart-bar" style="height: 90%;">
                                    <div class="chart-value">RM12,873</div>
                                    <div class="chart-label">Week 4</div>
                                </div>
                                </div>
                            </div>
                        </div>
                        
                        <div id="order-count" class="tab-content">
                            <div class="chart-container">
                                <div class="chart-bar" style="height: 62%;">
                                    <div class="chart-value">64</div>
                                    <div class="chart-label">Week 1</div>
                                </div>
                                <div class="chart-bar" style="height: 100%;">
                                    <div class="chart-value">103</div>
                                    <div class="chart-label">Week 2</div>
                                </div>
                                <div class="chart-bar" style="height: 73%;">
                                    <div class="chart-value">75</div>
                                    <div class="chart-label">Week 3</div>
                                </div>
                                <div class="chart-bar" style="height: 78%;">
                                    <div class="chart-value">80</div>
                                    <div class="chart-label">Week 4</div>
                                </div>

                                </div>
                            </div>
                        </div>
                        
                        <div id="popular-items" class="tab-content">
                            <div class="pie-chart-container">
                                <div class="pie-chart">
                                    <div class="pie-segment" style="--percentage: 30%; --color: #4285F4;">
                                    </div>
                                    <div class="pie-segment" style="--percentage: 25%; --color: #34A853;">
                                    </div>
                                    <div class="pie-segment" style="--percentage: 22%; --color: #FBBC05;">
                                    </div>
                                    <div class="pie-segment" style="--percentage: 23%; --color: #EA4335;">
                                    </div>
                                </div>
                                <div class="pie-legend">
                                    <div class="legend-item">
                                        <span class="legend-color" style="background-color: #4285F4;"></span>
                                        <span class="legend-text">Roti Canai Special (50%)</span>
                                    </div>
                                    <div class="legend-item">
                                        <span class="legend-color" style="background-color: #34A853;"></span>
                                        <span class="legend-text">Roti Tampal (25%)</span>
                                    </div>
                                    <div class="legend-item">
                                        <span class="legend-color" style="background-color: #FBBC05;"></span>
                                        <span class="legend-text">Roti Telur (22%)</span>
                                    </div>
                                    <div class="legend-item">
                                        <span class="legend-color" style="background-color: #EA4335;"></span>
                                        <span class="legend-text">Spinach & Ricotta Ravioli (23%)</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>\

                    <div>
                            <p style="color: var(--grab-green-dark); font-weight: 500; margin-bottom: 12px;">
                                Monthly Business Analysis:
                            </p>


                            <div style="margin-bottom: 15px;">
                                <p style="font-weight: 500; color: var(--grab-green-dark); margin-bottom: 8px;">
                                    <i class="fas fa-clock" style="margin-right: 8px;"></i>
                                    Peak Hours Analysis:
                                </p>
                                <ul style="list-style-type: none; padding-left: 24px;">
                                    <li style="margin-bottom: 6px; position: relative;">
                                        <span style="position: absolute; left: -20px;"></span>
                                        Busiest hours: 7-9 AM and 12-2 PM
                                    </li>
                                    <li style="margin-bottom: 6px; position: relative;">
                                        <span style="position: absolute; left: -20px;"></span>
                                        Recommended: Add more staff during these periods
                                    </li>
                                    <li style="position: relative;">
                                        <span style="position: absolute; left: -20px;"></span>
                                        Average customer wait time: 8 minutes
                                    </li>
                                </ul>
                            </div>

                            <div style="margin-bottom: 15px;">
                                <p style="font-weight: 500; color: var(--grab-green-dark); margin-bottom: 8px;">
                                    <i class="fas fa-utensils" style="margin-right: 8px;"></i>
                                    Menu Performance:
                                </p>
                                <ul style="list-style-type: none; padding-left: 24px;">
                                    <li style="margin-bottom: 6px; position: relative;">
                                        <span style="position: absolute; left: -20px;"></span>
                                        Roti Canai Special: 50% of total revenue
                                    </li>
                                    <li style="margin-bottom: 6px; position: relative;">
                                        <span style="position: absolute; left: -20px;"></span>
                                        Suggested: Create combo deals with top sellers
                                    </li>
                                    <li style="position: relative;">
                                        <span style="position: absolute; left: -20px;"></span>
                                        Customer favorite add-ons: Extra cheese, special sauce
                                    </li>
                                </ul>
                            </div>

                            <div>
                                <p style="font-weight: 500; color: var(--grab-green-dark); margin-bottom: 8px;">
                                    <i class="fas fa-chart-line" style="margin-right: 8px;"></i>
                                    Growth Opportunities:
                                </p>
                                <ul style="list-style-type: none; padding-left: 24px;">
                                    <li style="margin-bottom: 6px; position: relative;">
                                        <span style="position: absolute; left: -20px;"></span>
                                        Evening sales are lower than morning/afternoon
                                    </li>
                                    <li style="margin-bottom: 6px; position: relative;">
                                        <span style="position: absolute; left: -20px;"></span>
                                        Opportunity: Run promotions during off-peak hours
                                    </li>
                                    <li style="position: relative;">
                                        <span style="position: absolute; left: -20px;"></span>
                                        Consider: Evening special menu or family packages
                                    </li>
                                </ul>
                            </div>
                        </div>
                `;
                addMessage(chartHtml);
                
                // Third response: Insights (after 1 second)
                setTimeout(() => {
                    const insightsHtml = `
                        <div>
                            <p style="color: var(--grab-green-dark); font-weight: 500; margin-bottom: 12px;">
                                Monthly Business Analysis:
                            </p>

                            <div style="padding: 12px; background: var(--grab-green-light); border-radius: 12px; margin-bottom: 15px;">
                                <p style="margin-bottom: 10px; color: var(--grab-green-dark);">
                                    <i class="fas fa-lightbulb" style="margin-right: 8px;"></i>
                                    Local Market Insight
                                </p>
                                <p style="color: var(--soft-black);">
                                    Since you're a small caf in Kedah, consider bundling Roti Jala & Teh Tarik  last week, similar outlets saw 18% spike with this offer.
                                </p>
                            </div>

                            <div style="margin-bottom: 15px;">
                                <p style="font-weight: 500; color: var(--grab-green-dark); margin-bottom: 8px;">
                                    <i class="fas fa-clock" style="margin-right: 8px;"></i>
                                    Peak Hours Analysis:
                                </p>
                                <ul style="list-style-type: none; padding-left: 24px;">
                                    <li style="margin-bottom: 6px; position: relative;">
                                        <span style="position: absolute; left: -20px;"></span>
                                        Busiest hours: 7-9 AM and 12-2 PM
                                    </li>
                                    <li style="margin-bottom: 6px; position: relative;">
                                        <span style="position: absolute; left: -20px;"></span>
                                        Recommended: Add more staff during these periods
                                    </li>
                                    <li style="position: relative;">
                                        <span style="position: absolute; left: -20px;"></span>
                                        Average customer wait time: 8 minutes
                                    </li>
                                </ul>
                            </div>

                            <div style="margin-bottom: 15px;">
                                <p style="font-weight: 500; color: var(--grab-green-dark); margin-bottom: 8px;">
                                    <i class="fas fa-utensils" style="margin-right: 8px;"></i>
                                    Menu Performance:
                                </p>
                                <ul style="list-style-type: none; padding-left: 24px;">
                                    <li style="margin-bottom: 6px; position: relative;">
                                        <span style="position: absolute; left: -20px;"></span>
                                        Roti Canai Special: 50% of total revenue
                                    </li>
                                    <li style="margin-bottom: 6px; position: relative;">
                                        <span style="position: absolute; left: -20px;"></span>
                                        Suggested: Create combo deals with top sellers
                                    </li>
                                    <li style="position: relative;">
                                        <span style="position: absolute; left: -20px;"></span>
                                        Customer favorite add-ons: Extra cheese, special sauce
                                    </li>
                                </ul>
                            </div>

                            <div>
                                <p style="font-weight: 500; color: var(--grab-green-dark); margin-bottom: 8px;">
                                    <i class="fas fa-chart-line" style="margin-right: 8px;"></i>
                                    Growth Opportunities:
                                </p>
                                <ul style="list-style-type: none; padding-left: 24px;">
                                    <li style="margin-bottom: 6px; position: relative;">
                                        <span style="position: absolute; left: -20px;"></span>
                                        Evening sales are lower than morning/afternoon
                                    </li>
                                    <li style="margin-bottom: 6px; position: relative;">
                                        <span style="position: absolute; left: -20px;"></span>
                                        Opportunity: Run promotions during off-peak hours
                                    </li>
                                    <li style="position: relative;">
                                        <span style="position: absolute; left: -20px;"></span>
                                        Consider: Evening special menu or family packages
                                    </li>
                                </ul>
                            </div>
                        </div>
                    `;
                }, 1000);
            }, 1000);
        }
        
        // Call the function to show weekend sales prompt after business performance
        document.addEventListener('DOMContentLoaded', function() {
            // Existing code for language preference
            const savedLanguage = localStorage.getItem('selectedLanguage');
            if (savedLanguage === 'Bahasa Melayu') {
                translateToBahasaMelayu();
                
                // Update the selected language in the dropdown
                const options = document.querySelectorAll('.language-option');
                options.forEach(option => {
                    option.classList.remove('language-selected');
                });
                
                const selectedOption = document.querySelector(`.language-option[onclick*="Bahasa Melayu"]`);
                if (selectedOption) {
                    selectedOption.classList.add('language-selected');
                }
            }
        });
        
        // Modify the send button click event to trigger the weekend sales prompt
        document.querySelector('.send-button').addEventListener('click', function() {
            const message = chatInput.value.trim();
            if (message) {
                addMessage(message, true);
                chatInput.value = '';
                // Handle user message based on current chat
                handleUserMessage(message);
                
                // Trigger the weekend sales prompt if the message is related to weekend sales
                if (message.toLowerCase().includes('weekend') || message.toLowerCase().includes('saturday') || message.toLowerCase().includes('sunday')) {
                    showWeekendSalesPrompt();
                }
            }
        });
        
        // Function to show a notification that redirects to Business Insights
        function showBusinessInsightNotification() {
            // Create notification element
            const notification = document.createElement('div');
            notification.className = 'proactive-notification';
            notification.style.position = 'fixed';
            notification.style.top = '20px';
            notification.style.left = '50%';
            notification.style.transform = 'translateX(-50%)';
            notification.style.backgroundColor = 'white';
            notification.style.borderRadius = '12px';
            notification.style.padding = '15px';
            notification.style.boxShadow = '0 4px 20px rgba(0, 0, 0, 0.15)';
            notification.style.zIndex = '1000';
            notification.style.width = '90%';
            notification.style.maxWidth = '350px';
            notification.style.animation = 'slideDown 0.5s ease-out forwards';
            
            // Add notification content
            notification.innerHTML = `
                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                    <div style="width: 40px; height: 40px; border-radius: 50%; background-color: var(--grab-green-light); display: flex; align-items: center; justify-content: center;">
                        <i class="fas fa-chart-line" style="color: var(--grab-green); font-size: 20px;"></i>
                    </div>
                    <div>
                        <div style="font-weight: 600; color: var(--grab-green-dark);">Business Insight Alert</div>
                        <div style="font-size: 14px; color: var(--secondary-text);">Just now</div>
                    </div>
                </div>
                <div style="margin-top: 10px; font-size: 16px;">
                    I've noticed your weekend sales are 15% lower than weekday sales. Would you like to see a detailed analysis?
                </div>
                <div style="display: flex; gap: 10px; margin-top: 15px;">
                    <button onclick="showInsightsChat(); removeNotification(this)" style="flex: 1; padding: 10px; background-color: var(--grab-green); color: white; border: none; border-radius: 8px; font-weight: 500; cursor: pointer;">
                        View Analysis
                        </button>
                    <button onclick="removeNotification(this)" style="flex: 1; padding: 10px; background-color: var(--light-gray-bg); color: var(--secondary-text); border: none; border-radius: 8px; font-weight: 500; cursor: pointer;">
                        Dismiss
                        </button>
                </div>
            `;
            
            // Add notification to the body
            document.body.appendChild(notification);
            
            // Add animation keyframes if they don't exist
            if (!document.querySelector('style#notification-animations')) {
                const style = document.createElement('style');
                style.id = 'notification-animations';
                style.textContent = `
                    @keyframes slideDown {
                        from { opacity: 0; transform: translate(-50%, -100%); }
                        to { opacity: 1; transform: translate(-50%, 0); }
                    }
                    
                    @keyframes slideUp {
                        from { opacity: 1; transform: translate(-50%, 0); }
                        to { opacity: 0; transform: translate(-50%, -100%); }
                    }
                `;
                document.head.appendChild(style);
            }
        }

        function removeNotification(button) {
            const notification = button.closest('.proactive-notification');
            if (notification) {
                notification.style.animation = 'slideUp 0.5s ease-out forwards';
                    setTimeout(() => {
                    notification.remove();
                    }, 500);
            }
        }
        
        // Function to show weekly business report
        function showWeeklyBusinessReport() {
            const weeklyReportHtml = `
                <div class="weekly-report-container">
                    <div class="report-header">
                        <h3>Roti Canai King - Weekly Report</h3>
                        <p>Period: December 25 - December 31, 2023</p>
                    </div>
                    
                    <div class="report-section">
                        <h4>Executive Summary</h4>
                        <p>For the week ending December 31, 2023, Roti<br>Canai King achieved:</p>
                        
                        <ul>
                            <li><strong>Total Revenue:</strong> RM70,885.34</li>
                            <li><strong>Total Orders:</strong> 575</li>
                            <li><strong>Average Order Value:</strong> RM123.28</li>
                            <li><strong>Unique Customers:</strong> 575</li>
                            <li><strong>Average Delivery Time:</strong> 38.5 minutes</li>
                        </ul>
                    </div>
                    
                    <div class="report-section">
                        <h4>Daily Performance</h4>
                        <table class="performance-table">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Orders</th>
                                    <th>Revenue (RM)</th>
                                    <th>Avg Order Value (RM)</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>12-25</td>
                                    <td>64</td>
                                    <td>6,105.00</td>
                                    <td>95.39</td>
                                </tr>
                                <tr>
                                    <td>12-26</td>
                                    <td>103</td>
                                    <td>14,263.97</td>
                                    <td>138.48</td>
                                </tr>
                                <tr>
                                    <td>12-27</td>
                                    <td>75</td>
                                    <td>8,845.25</td>
                                    <td>118.20</td>
                                </tr>
                                <tr>
                                    <td>12-28</td>
                                    <td>80</td>
                                    <td>12,872.74</td>
                                    <td>160.91</td>
                                </tr>
                                <tr>
                                    <td>12-29</td>
                                    <td>75</td>
                                    <td>8,316.91</td>
                                    <td>110.89</td>
                                </tr>
                                <tr>
                                    <td>12-30</td>
                                    <td>89</td>
                                    <td>13,769.31</td>
                                    <td>154.71</td>
                                </tr>
                                <tr>
                                    <td>12-31</td>
                                    <td>89</td>
                                    <td>6,783.86</td>
                                    <td>76.22</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="report-section">
                        <h4>Top Selling Items</h4>
                        <table class="items-table">
                            <thead>
                                <tr>
                                    <th>Item Name</th>
                                    <th>Orders</th>
                                    <th>Total Revenue (RM)</th>
                                    <th>Average Price (RM)</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Fettuccine Alfredo</td>
                                    <td>152</td>
                                    <td>1,520.00</td>
                                    <td>10.00</td>
                                </tr>
                                <tr>
                                    <td>Garlic Bread</td>
                                    <td>125</td>
                                    <td>375.00</td>
                                    <td>3.00</td>
                                </tr>
                                <tr>
                                    <td>Spaghetti Bolognese</td>
                                    <td>112</td>
                                    <td>1,120.00</td>
                                    <td>10.00</td>
                                </tr>
                                <tr>
                                    <td>Spinach & Ricotta Ravioli</td>
                                    <td>113</td>
                                    <td>1,130.00</td>
                                    <td>10.00</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="report-tabs">
                        <div class="tab-header">
                            <button class="tab-button active" onclick="switchTab(event, 'daily-revenue')">
                                <i class="fas fa-chart-line"></i> Daily Revenue
                            </button>
                            <button class="tab-button" onclick="switchTab(event, 'order-count')">
                                <i class="fas fa-shopping-cart"></i> Order Count
                            </button>
                            <button class="tab-button" onclick="switchTab(event, 'popular-items')">
                                <i class="fas fa-chart-pie"></i> Popular Items
                            </button>
                        </div>
                        
                        <div id="daily-revenue" class="tab-content active">
                            <div class="chart-container">
                                <div class="chart-bar" style="height: 60%;">
                                    <div class="chart-value">RM6,105</div>
                                    <div class="chart-label">Dec 25</div>
                                </div>
                                <div class="chart-bar" style="height: 100%;">
                                    <div class="chart-value">RM14,264</div>
                                    <div class="chart-label">Dec 26</div>
                                </div>
                                <div class="chart-bar" style="height: 65%;">
                                    <div class="chart-value">RM8,845</div>
                                    <div class="chart-label">Dec 27</div>
                                </div>
                                <div class="chart-bar" style="height: 90%;">
                                    <div class="chart-value">RM12,873</div>
                                    <div class="chart-label">Dec 28</div>
                                </div>
                                <div class="chart-bar" style="height: 62%;">
                                    <div class="chart-value">RM8,317</div>
                                    <div class="chart-label">Dec 29</div>
                                </div>
                                <div class="chart-bar" style="height: 95%;">
                                    <div class="chart-value">RM13,769</div>
                                    <div class="chart-label">Dec 30</div>
                                </div>
                                <div class="chart-bar" style="height: 50%;">
                                    <div class="chart-value">RM6,784</div>
                                    <div class="chart-label">Dec 31</div>
                                </div>
                            </div>
                        </div>
                        
                        <div id="order-count" class="tab-content">
                            <div class="chart-container">
                                <div class="chart-bar" style="height: 62%;">
                                    <div class="chart-value">64</div>
                                    <div class="chart-label">Dec 25</div>
                                </div>
                                <div class="chart-bar" style="height: 100%;">
                                    <div class="chart-value">103</div>
                                    <div class="chart-label">Dec 26</div>
                                </div>
                                <div class="chart-bar" style="height: 73%;">
                                    <div class="chart-value">75</div>
                                    <div class="chart-label">Dec 27</div>
                                </div>
                                <div class="chart-bar" style="height: 78%;">
                                    <div class="chart-value">80</div>
                                    <div class="chart-label">Dec 28</div>
                                </div>
                                <div class="chart-bar" style="height: 73%;">
                                    <div class="chart-value">75</div>
                                    <div class="chart-label">Dec 29</div>
                                </div>
                                <div class="chart-bar" style="height: 86%;">
                                    <div class="chart-value">89</div>
                                    <div class="chart-label">Dec 30</div>
                                </div>
                                <div class="chart-bar" style="height: 86%;">
                                    <div class="chart-value">89</div>
                                    <div class="chart-label">Dec 31</div>
                                </div>
                            </div>
                        </div>
                        
                        <div id="popular-items" class="tab-content">
                            <div class="pie-chart-container">
                                <div class="pie-chart">
                                    <div class="pie-segment" style="--percentage: 30%; --color: #4285F4;">
                    
                                    </div>
                                    <div class="pie-segment" style="--percentage: 25%; --color: #34A853;">
                            
                                    </div>
                                    <div class="pie-segment" style="--percentage: 22%; --color: #FBBC05;">
                        
                                    </div>
                                    <div class="pie-segment" style="--percentage: 23%; --color: #EA4335;">
                          
                                    </div>
                                </div>
                                <div class="pie-legend">
                                    <div class="legend-item">
                                        <span class="legend-color" style="background-color: #4285F4;"></span>
                                        <span class="legend-text">Fettuccine Alfredo (30%)</span>
                                    </div>
                                    <div class="legend-item">
                                        <span class="legend-color" style="background-color: #34A853;"></span>
                                        <span class="legend-text">Garlic Bread (25%)</span>
                                    </div>
                                    <div class="legend-item">
                                        <span class="legend-color" style="background-color: #FBBC05;"></span>
                                        <span class="legend-text">Spaghetti Bolognese (22%)</span>
                                    </div>
                                    <div class="legend-item">
                                        <span class="legend-color" style="background-color: #EA4335;"></span>
                                        <span class="legend-text">Spinach & Ricotta Ravioli (23%)</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="report-summary">
                        <h4>Business Summary</h4>
                        <div class="summary-value">
                            <span>Total Weekly Revenue</span>
                            <strong>RM70,885.34</strong>
                        </div>
                    </div>
                    
                    <div class="report-actions">
                        <button class="pdf-button" onclick="generatePDF()">
                            <i class="fas fa-file-pdf"></i> Generate PDF Report
                        </button>
                    </div>
                </div>
            `;
            addMessage(weeklyReportHtml);
        }

        function showWeeklyBusinessReportinKedah() {

            const weeklyReportHtml = `

                <div class="weekly-report-container">
                    <div class="report-header">
                        <h3>Roti Canai King - Analisis Perniagaan Harian</h3>
                        <p>Tarikh: 1 Januari 2025</p>
                    </div>
                    
                    <div class="report-section">
                        <h4>Ringkasan Eksekutif</h4>
                        <ul>
                            <li><strong>Jumlah Jualan:</strong> RM1,234.56</li>
                            <li><strong>Bilangan Pesanan:</strong> 125</li>
                            <li><strong>Nilai Transaksi Purata:</strong> RM 14.80</li>
                            <li><strong>Pelanggan Unik:</strong> 125</li>
                            <li><strong>Waktu Puncak:</strong> 7.00 AM - 9.00 AM</li>
                            <li><strong>Item Paling Laras:</strong> Roti Canai Biasa</li>
                        </ul>
                    </div>


                    <div>
                </div>
            
                    
                    <div class="report-section">
                        <h4>Analisis Perniagaan Harian</h4>
                         <div style="margin-bottom: 15px;">
                                <p style="font-weight: 500; color: var(--grab-green-dark); margin-bottom: 8px;">
                                    <i class="fas fa-clock" style="margin-right: 8px;"></i>
                                    Pecahan Jualan Mengikut Sesi:
                                </p>
                                <ul style="list-style-type: none; padding-left: 24px;">
                                    <li style="margin-bottom: 6px; position: relative;">
                                        <span style="position: absolute; left: -20px;"></span>
                                        Sarapan (7 AM - 11 AM): RM 950.00 (51.4% daripada Jumlah Jualan) - Menunjukkan kebergantungan tinggi pada waktu pagi.
                                    </li>
                                    <li style="margin-bottom: 6px; position: relative;">
                                        <span style="position: absolute; left: -20px;"></span>
                                        Tengahari (11 AM - 3 PM): RM 550.00 (29.7%) - Prestasi sederhana.
                                    </li>
                                    <li style="position: relative;">
                                        <span style="position: absolute; left: -20px;"></span>
                                        Petang/Malam (3 PM - 7 PM): RM 350.00 (18.9%) - Jualan paling rendah.
                                    </li>
                                </ul>
                            </div>

                            <div style="margin-bottom: 15px;">
                                <p style="font-weight: 500; color: var(--grab-green-dark); margin-bottom: 8px;">
                                    <i class="fas fa-utensils" style="margin-right: 8px;"></i>
                                    Analisis Item
                                </p>
                                <ul style="list-style-type: none; padding-left: 24px;">
                                    <li style="margin-bottom: 6px; position: relative;">
                                        <span style="position: absolute; left: -20px;"></span>
                                        Roti Canai Biasa (180 unit) dan Roti Telur (95 unit) menyumbang kepada sebahagian besar jualan roti.
                                    </li>
                                    <li style="margin-bottom: 6px; position: relative;">
                                        <span style="position: absolute; left: -20px;"></span>
                                        Roti Planta (30 unit) dan Roti Sardin (25 unit) menunjukkan jualan yang lebih rendah.
                                    </li>
                                    <li style="position: relative;">
                                        <span style="position: absolute; left: -20px;"></span>
                                        Teh Tarik (150 unit) mempunyai Kadar Lekatan (Attach Rate) yang tinggi dengan jualan roti. Hampir setiap transaksi melibatkan minuman ini.
                                    </li>
                                </ul>
                            </div>

                            <div>
                                <p style="font-weight: 500; color: var(--grab-green-dark); margin-bottom: 8px;">
                                    <i class="fas fa-chart-line" style="margin-right: 8px;"></i>
                                    Peluang Pertumbuhan:
                                </p>
                                <ul style="list-style-type: none; padding-left: 24px;">
                                    <li style="margin-bottom: 6px; position: relative;">
                                        <span style="position: absolute; left: -20px;"></span>
                                        Prestasi perniagaan sangat bergantung pada waktu sarapan. Ini merupakan Penggerak Hasil Utama
                                    </li>
                                    <li style="margin-bottom: 6px; position: relative;">
                                        <span style="position: absolute; left: -20px;"></span>
                                        Terdapat peluang untuk meningkatkan nilai perbelanjaan setiap pelanggan, terutamanya semasa waktu bukan puncak.
                                    </li>
                                    <li style="position: relative;">
                                        <span style="position: absolute; left: -20px;"></span>
                                        Roti Canai Biasa dan Teh Tarik adalah produk 'hero' yang perlu sentiasa dikekalkan kualitinya.                                    </li>
                                    <li style="position: relative;">
                                        <span style="position: absolute; left: -20px;"></span>
                                        Pertimbangkan untuk memperkenalkan Tawaran Kombo atau diskaun kecil pada waktu tengahari dan petang untuk Memacu Jualan dan meningkatkan ATV.
                                    </li>

                                </ul>
                            </div>
                    <div>
                </div>
            `;
            addMessage(weeklyReportHtml);
        }
        
        // Function to switch between tabs in the report
        function switchTab(event, tabId) {
            // Hide all tab contents
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all tab buttons
            const tabButtons = document.querySelectorAll('.tab-button');
            tabButtons.forEach(button => {
                button.classList.remove('active');
            });
            
            // Show the selected tab content and mark button as active
            document.getElementById(tabId).classList.add('active');
            event.currentTarget.classList.add('active');
        }
        
        // Function to simulate PDF generation
        function generatePDF() {
            // Show a loading message
            const loadingMessage = document.createElement('div');
            loadingMessage.className = 'pdf-loading';
            loadingMessage.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Generating PDF...';
            document.body.appendChild(loadingMessage);
            
            // Simulate PDF generation with a timeout
            setTimeout(() => {
                // Remove loading message
                document.body.removeChild(loadingMessage);
                
                // Show success message
                const successMessage = document.createElement('div');
                successMessage.className = 'pdf-success';
                successMessage.innerHTML = '<i class="fas fa-check-circle"></i> PDF Report Generated Successfully!';
                document.body.appendChild(successMessage);
                
                // Remove success message after a few seconds
                setTimeout(() => {
                    document.body.removeChild(successMessage);
                }, 3000);
            }, 2000);
        }

        function handleVoiceInteraction(voiceStep) {
            // First show the recording interface
            const recordingHtml = `
                <div class="recording-interface">
                    <div class="recording-animation">
                        <div class="recording-wave"></div>
                        <div class="recording-wave"></div>
                        <div class="recording-wave"></div>
                        <div class="recording-wave"></div>
                        <div class="recording-wave"></div>
                    </div>
                    <div class="recording-text">
                        Listening...
                    </div>
                </div>
            `;
            const recordingMessage = addMessage(recordingHtml, true);
            
            // After 2 seconds, remove the recording interface and show the actual prompt
            setTimeout(() => {
                recordingMessage.remove();
                
                // Determine which prompt and response to use based on the step
                const promptIndex = Math.floor((voiceStep - 5) / 2);
                if (promptIndex >= 0 && promptIndex < kedahanPrompts.length) {
                    // Show Kedahan prompt as text in bubble
                    addMessage(kedahanPrompts[promptIndex], true);
                    
                    // After a delay, show AI's response
                    setTimeout(() => {
                        const responseHtml = `
                            <div >
                                <p style="margin-bottom: 8px;">
                                    ${kedahanResponses[promptIndex]}
                                </p>
                                    ${promptIndex === 0 ? `
                                <div style="background: var(--grab-green-light); padding: 12px; border-radius: 8px; margin-top: 8px;">

                                        <div style="background-color: var(--grab-green-light); border-radius: 12px; padding: 15px; margin-top: 12px;">
                                    <div style="display: flex; align-items: center; margin-bottom: 10px;">
                                        <div style="width: 30px; height: 30px; border-radius: 50%; background-color: var(--grab-green); display: flex; align-items: center; justify-content: center; margin-right: 10px;">
                                            <i class="fas fa-utensils" style="color: white; font-size: 14px;"></i>
                                        </div>
                                        <div style="font-weight: 600; color: var(--grab-green-dark);">Roti Planta</div>
                                    </div>
                                    <div style="display: flex; align-items: center; margin-bottom: 10px;">
                                        <div style="width: 30px; height: 30px; border-radius: 50%; background-color: var(--grab-green); display: flex; align-items: center; justify-content: center; margin-right: 10px;">
                                            <i class="fas fa-tag" style="color: white; font-size: 14px;"></i>
                                        </div>
                                        <div style="font-weight: 600; color: var(--grab-green-dark);">RM 6.90</div>
                                    </div>
                                    <div style="display: flex; align-items: center;">
                                        <div style="width: 30px; height: 30px; border-radius: 50%; background-color: var(--grab-green); display: flex; align-items: center; justify-content: center; margin-right: 10px;">
                                            <i class="fas fa-layer-group" style="color: white; font-size: 14px;"></i>
                                        </div>
                                        <div style="font-weight: 600; color: var(--grab-green-dark);">Roti</div>
                                    </div>
                                </div>
                                    ` : `
                                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                    <div style="width: 40px; height: 40px; border-radius: 50%; background-color: var(--grab-green-light); display: flex; align-items: center; justify-content: center;">
                        <i class="fas fa-check" style="color: var(--grab-green); font-size: 20px;"></i>
                    </div>
                    <div>
                        <div style="font-weight: 600; color: var(--grab-green-dark);">Menu Barang sudah berjaya dibuang!</div>
                        <div style="font-size: 14px; color: var(--secondary-text);">Roti Planta telah dibuang ke menu anda</div>
                    </div>
                </div>
                <div style="margin-top: 15px; padding: 12px; background-color: var(--light-gray-bg); border-radius: 10px; font-size: 14px;">
                    <div style="margin-bottom: 8px;"><strong>Notifikasi dikirim:</strong></div>
                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 5px;">
                        <i class="fas fa-bell" style="color: var(--grab-green);"></i>
                        <span>Notifikasi dikirim kepada staf</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <i class="fas fa-envelope" style="color: var(--grab-green);"></i>
                        <span>Email konfirmasi dikirim kepada email anda</span>
                    </div>
                </div>
                                    `}
                                </div>
                            </div>
                        `;
                        addMessage(responseHtml, false);
                    }, 1500);
                }
            }, 2000);
        }

        function toggleRecording() {
            const micButton = document.getElementById('mic-button');
            isRecording = !isRecording;
            
            if (isRecording) {
                micButton.classList.add('recording');
                currentVoiceStep = currentVoiceStep === 0 ? 5 : 7; // Toggle between steps 5 and 7
                handleVoiceInteraction(currentVoiceStep);
                
                // Automatically stop recording after 2 seconds
                setTimeout(() => {
                    micButton.classList.remove('recording');
                    isRecording = false;
                }, 2000);
            } else {
                micButton.classList.remove('recording');
            }
        }

        // Add popup container to body
        document.body.insertAdjacentHTML('beforeend', `
            <div class="visual-popup">
                <div class="popup-content">
                    <div class="popup-header">
                        <div class="popup-title"></div>
                        <div class="popup-close" onclick="closePopup()">
                            <i class="fas fa-times"></i>
                        </div>
                    </div>
                    <div class="popup-body">
                        <div class="popup-visual"></div>
                    </div>
                    <div class="zoom-controls">
                        <button class="zoom-button" onclick="zoomIn()">
                            <i class="fas fa-plus"></i>
                        </button>
                        <button class="zoom-button" onclick="zoomOut()">
                            <i class="fas fa-minus"></i>
                        </button>
                    </div>
                </div>
            </div>
        `);

        let currentZoomLevel = 1;
        const MAX_ZOOM = 3;
        const MIN_ZOOM = 0.5;

        function showPopup(title, content) {
            const popup = document.querySelector('.visual-popup');
            const popupTitle = popup.querySelector('.popup-title');
            const popupVisual = popup.querySelector('.popup-visual');
            
            popupTitle.textContent = title;
            popupVisual.innerHTML = content;
            currentZoomLevel = 1;
            updateZoom();
            
            popup.style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }

        function closePopup() {
            const popup = document.querySelector('.visual-popup');
            popup.style.display = 'none';
            document.body.style.overflow = '';
        }

        function zoomIn() {
            if (currentZoomLevel < MAX_ZOOM) {
                currentZoomLevel += 0.25;
                updateZoom();
            }
        }

        function zoomOut() {
            if (currentZoomLevel > MIN_ZOOM) {
                currentZoomLevel -= 0.25;
                updateZoom();
            }
        }

        function updateZoom() {
            const popupVisual = document.querySelector('.popup-visual');
            popupVisual.style.transform = `scale(${currentZoomLevel})`;
        }

        // Add click handlers to all chart containers and visual elements
        document.addEventListener('click', function(e) {
            const chartContainer = e.target.closest('.chart-container, .graph-container, .metrics-grid, .insights-container');
            if (chartContainer) {
                const title = chartContainer.querySelector('.chart-title')?.textContent || 'Business Visual';
                showPopup(title, chartContainer.outerHTML);
            }
        });

        // Enable touch gestures for zooming
        let touchStartDistance = 0;

        document.querySelector('.popup-content').addEventListener('touchstart', function(e) {
            if (e.touches.length === 2) {
                touchStartDistance = Math.hypot(
                    e.touches[0].pageX - e.touches[1].pageX,
                    e.touches[0].pageY - e.touches[1].pageY
                );
            }
        });

        document.querySelector('.popup-content').addEventListener('touchmove', function(e) {
            if (e.touches.length === 2) {
                e.preventDefault();
                const currentDistance = Math.hypot(
                    e.touches[0].pageX - e.touches[1].pageX,
                    e.touches[0].pageY - e.touches[1].pageY
                );
                
                if (touchStartDistance) {
                    const diff = currentDistance - touchStartDistance;
                    if (Math.abs(diff) > 10) {
                        if (diff > 0) {
                            zoomIn();
                        } else {
                            zoomOut();
                        }
                        touchStartDistance = currentDistance;
                    }
                }
            }
        });

        // Add a new function to handle promotion responses based on keywords
        function handlePromotionsResponse(message) {
            const lowerMessage = message.toLowerCase();
            
            // Show typing indicator
            showTypingIndicator();
            
            setTimeout(() => {
                // Hide typing indicator
                hideTypingIndicator();
                
                // Check for promotion related keywords
                if (lowerMessage.includes('promote') || lowerMessage.includes('boost') || lowerMessage.includes('advertise') || 
                    lowerMessage.includes('market') || lowerMessage.includes('campaign')) {
                    
                    // Trigger promotion setup
                    handlePromotionDecision('promote');
                }
                // Check for dismiss related keywords
                else if (lowerMessage.includes('dismiss') || lowerMessage.includes('no') || lowerMessage.includes('cancel') || 
                        lowerMessage.includes('reject') || lowerMessage.includes('don\'t') || lowerMessage.includes('dont')) {
                    
                    // Dismiss promotion
                    handlePromotionDecision('dismiss');
                }
                // Check for confirmation keywords
                else if (lowerMessage.includes('confirm') || lowerMessage.includes('yes') || lowerMessage.includes('sure') || 
                        lowerMessage.includes('proceed') || lowerMessage.includes('ok')) {
                    
                    // If we're at the confirmation stage with duration and audience already set
                    if (document.getElementById('promotion-duration') && document.getElementById('target-audience')) {
                        showPromotionConfirmation();
                    } else {
                        addMessage('Would you like to set up a promotion for one of your menu items?', false);
                    }
                }
                // Check for specific menu item promotion interest
                else if (lowerMessage.includes('roti canai special') || lowerMessage.includes('special roti')) {
                    addMessage('Roti Canai Special is performing very well! Would you like to create a promotion to boost it further?', false);
                }
                else if (lowerMessage.includes('roti jala')) {
                    addMessage('Roti Jala needs more attention. Would you like to set up a promotion campaign for it?', false);
                }
                // Check for duration or audience related terms
                else if (lowerMessage.includes('day') || lowerMessage.includes('week') || lowerMessage.includes('duration') || 
                        lowerMessage.includes('how long')) {
                    
                    const setupHtml = `
                        <div>
                            <p>How many days would you like your promotion to run?</p>
                            <div style="margin-bottom: 15px;">
                                <input type="number" id="promotion-duration" min="1" max="30" value="3" onchange="updatePromotionPrice()" style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid var(--border-color);">
                            </div>
                            <div style="background: var(--grab-green-light); padding: 12px; border-radius: 8px; margin-top: 15px;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                    <span style="color: var(--grab-green-dark);">Price per day:</span>
                                    <span style="font-weight: 500; color: var(--grab-green-dark);">RM5</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; align-items: center; font-weight: 600;">
                                    <span style="color: var(--grab-green-dark);">Total Price:</span>
                                    <span style="color: var(--grab-green-dark);" id="total-price">RM15</span>
                                </div>
                            </div>
                            <button onclick="showPromotionConfirmation()" class="action-button" style="width: 100%; margin-top: 15px;">
                                <i class="fas fa-check"></i> Confirm Duration
                            </button>
                        </div>
                    `;
                    addMessage(setupHtml);
                }
                else if (lowerMessage.includes('rm50') || lowerMessage.includes('my budget') || lowerMessage.includes('set it you self') || 
                        lowerMessage.includes('who')) {
                    
                    const audienceHtml = `
                        <div>
                            <p>Perfect! For a balanced approach, you could reach 200 customers over 5 days, which maintains good exposure while still reaching a sizable audience"</p>
                             <div style="background-color: var(--grab-green-light); border-radius: 12px; padding: 15px; margin-top: 12px;">
                                <div style="display: flex; align-items: center; margin-bottom: 10px;">
                                    <div style="width: 30px; height: 30px; border-radius: 50%; background-color: var(--grab-green); display: flex; align-items: center; justify-content: center; margin-right: 10px;">
                                        <i class="fas fa-user " style="color: white; font-size: 14px;"></i>
                                    </div>
                                    <div style="font-weight: 600; color: var(--grab-green-dark);">200 Total Users</div>
                                </div>
                                <div style="display: flex; align-items: center; margin-bottom: 10px;">
                                    <div style="width: 30px; height: 30px; border-radius: 50%; background-color: var(--grab-green); display: flex; align-items: center; justify-content: center; margin-right: 10px;">
                                        <i class="fas fa-clock" style="color: white; font-size: 14px;"></i>
                                    </div>
                                    <div style="font-weight: 600; color: var(--grab-green-dark);">5 days</div>
                                </div>
                            </div>
                            <p>Would you like to proceed with this promotion?</p>
                        </div>
                    `;
                    addMessage(audienceHtml);
                }
  
                else if (lowerMessage.includes('sure go on') || lowerMessage.includes('go on') || lowerMessage.includes('confirm')) {
                    
                    const CopyHtml = `
                       <p>Now let's get started with writing your promotion copy. Based on the current market trend, here are some suggested keywords for your promotion:</p>

                        <div style="background: var(--grab-green-light); padding: 15px; border-radius: 12px; margin: 15px 0;">
                            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                                <i class="fas fa-lightbulb" style="color: var(--grab-green);"></i>
                                <span style="color: var(--grab-green-dark); font-weight: 500;">Suggested Keywords</span>
                            </div>
                            <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 12px;">
                                <span style="background: white; padding: 6px 12px; border-radius: 15px; font-size: 13px; color: var(--grab-green);">#RotiJalaSpecial</span>
                                <span style="background: white; padding: 6px 12px; border-radius: 15px; font-size: 13px; color: var(--grab-green);">#MalaysianBreakfast</span>
                                <span style="background: white; padding: 6px 12px; border-radius: 15px; font-size: 13px; color: var(--grab-green);">#KedahFood</span>
                            </div>
                            <p style="margin: 0; color: var(--soft-black); font-size: 14px;">
                                Suggested copy: "Start your day with our signature Roti Jala! Perfectly crafted, crispy-soft texture with special curry sauce. Limited time offer!"
                            </p>
                        </div>

                        <button onclick="confirmPromotion()" class="action-button" style="width: 100%;">
                            <i class="fas fa-shopping-cart" action></i> Create Promotion
                        </button>
                    </div>
                    `;
                    addMessage(CopyHtml);
                }
                // Generic catch-all
                else {
                    addMessage(`
                        <div>
                            <p>I can help you create effective promotions for your menu items! You can:</p>
                            <ul>
                                <li>Set up a promotion for a specific menu item</li>
                                <li>Choose your target audience</li>
                                <li>Set the duration of your promotion</li>
                                <li>Check pricing and expected results</li>
                            </ul>
                            <p>What would you like to do?</p>
                        </div>
                    `, false);
                }
            }, 1000);
        }
    </script>
</body>
</html>
